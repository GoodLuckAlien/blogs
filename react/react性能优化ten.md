â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â‘ªâ‘«â‘¬â‘­â‘®â‘¯â‘°â‘±â‘²â‘³
# ã€Œreactè¿›é˜¶ã€å¹´ç»ˆé€ç»™reactå¼€å‘è€…çš„å…«æ¡ä¼˜åŒ–å»ºè®®

ç¬”è€…æ˜¯ä¸€ä¸ª `react` é‡åº¦çˆ±å¥½è€…ï¼Œåœ¨å·¥ä½œä¹‹ä½™ï¼Œä¹Ÿçœ‹äº†ä¸å°‘çš„ `react` æ–‡ç« , å†™äº†å¾ˆå¤š `react` é¡¹ç›® ,æ¥ä¸‹æ¥ç¬”è€…è®¨è®ºä¸€ä¸‹ React æ€§èƒ½ä¼˜åŒ–çš„ä¸»è¦æ–¹å‘å’Œä¸€äº›å·¥ä½œä¸­çš„å°æŠ€å·§ã€‚é€äººç«ç‘°ï¼Œæ‰‹ç•™ä½™é¦™ï¼Œé˜…è¯»çš„æœ‹å‹å¯ä»¥ç»™ç¬”è€…**ç‚¹èµï¼Œå…³æ³¨ä¸€æ³¢ã€‚**é™†ç»­æ›´æ–°å‰ç«¯æ–‡ç« ã€‚
æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œå°†ä» 
ç¼–è¯‘é˜¶æ®µ -> 
è·¯ç”±é˜¶æ®µ -> 
æ¸²æŸ“é˜¶æ®µ -> 
ç»†èŠ‚ä¼˜åŒ– -> 
çŠ¶æ€ç®¡ç† ->
é•¿åˆ—è¡¨æ¸²æŸ“  
åˆ†åˆ«åŠ ä»¥æ¢è®¨ã€‚

## ä¸€ ä»èµ·è·‘çº¿å¼€å§‹ï¼Œä¼˜åŒ–babelé…ç½®,webpacké…ç½®ä¸ºé¡¹


### çœŸå®é¡¹ç›®ä¸­ç—›ç‚¹
å½“æˆ‘ä»¬ç”¨`create-react-app`æˆ–è€…`webpack`æ‰“åŒ…`react`å·¥ç¨‹çš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰æƒ³è¿‡ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„é…ç½®èƒ½å¦è®©æˆ‘ä»¬çš„é¡¹ç›®æ›´å¿«çš„æ„å»ºé€Ÿåº¦ï¼Œæ›´å°çš„é¡¹ç›®ä½“ç§¯ï¼Œæ›´ç®€æ´æ¸…æ™°çš„é¡¹ç›®ç»“æ„ã€‚
éšç€æˆ‘ä»¬çš„é¡¹ç›®è¶Šåšè¶Šå¤§ï¼Œé¡¹ç›®ä¾èµ–è¶Šæ¥è¶Šå¤šï¼Œé¡¹ç›®ç»“æ„è¶Šæ¥è¶Šæ¥å¤æ‚ï¼Œé¡¹ç›®ä½“ç§¯å°±ä¼šè¶Šæ¥è¶Šå¤§ï¼Œæ„å»ºæ—¶é—´è¶Šæ¥è¶Šé•¿ï¼Œä¹…è€Œä¹…ä¹‹å°±ä¼šæˆäº†ä¸€ä¸ªåˆå¤§åˆé‡çš„é¡¹ç›®ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬è¦å­¦ä¼šé€‚å½“çš„ä¸ºé¡¹ç›®â€˜å‡è´Ÿâ€™ï¼Œè®©é¡¹ç›®ä¸èƒ½è¾“åœ¨èµ·è·‘çº¿ä¸Šã€‚

### ä¸€ä¸ªè€é¡¹ç›®
æ‹¿æˆ‘ä»¬ä¹‹å‰æ¥è§¦è¿‡çš„ä¸€ä¸ª`react`è€é¡¹ç›®ä¸ºä¾‹ã€‚æˆ‘ä»¬æ²¡æœ‰ç”¨`dva`,`umi`å¿«é€Ÿæ­å»ºreactï¼Œè€Œæ˜¯ç”¨reactè€ç‰ˆæœ¬è„šæ‰‹æ¶æ„å»ºçš„ï¼Œè¿™å¯¹è¿™ç§è€æ‰ç‰™çš„reacté¡¹ç›®ï¼Œä¸Šè¿°çš„é—®é¢˜éƒ½ä¼šå­˜åœ¨ï¼Œä¸‹é¢è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚

æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹é¡¹ç›®ç»“æ„ã€‚

å†çœ‹çœ‹æ„å»ºæ—¶é—´ã€‚

ä¸ºäº†æ–¹ä¾¿å¤§å®¶çœ‹æ„å»ºæ—¶é—´ï¼Œæˆ‘ç®€å•å†™äº†ä¸€ä¸ª`webpackï¼Œplugin` `ConsolePlugin` ,è®°å½•äº†`webpack`åœ¨ä¸€æ¬¡`compilation`æ‰€ç”¨çš„æ—¶é—´ã€‚

````js
const chalk = require('chalk') /* console é¢œè‰² */
var slog = require('single-line-log'); /* å•è¡Œæ‰“å° console */

class ConsolePlugin {
    constructor(options){
       this.options = options
    }
    apply(compiler){
        /**
         * Monitor file change è®°å½•å½“å‰æ”¹åŠ¨æ–‡ä»¶
         */
        compiler.hooks.watchRun.tap('ConsolePlugin', (watching) => {
            const changeFiles = watching.watchFileSystem.watcher.mtimes
            for(let file in changeFiles){
                console.log(chalk.green('å½“å‰æ”¹åŠ¨æ–‡ä»¶ï¼š'+ file))
            }
        })
        /**
         *  before a new compilation is created. å¼€å§‹ compilation ç¼–è¯‘ ã€‚
         */
        compiler.hooks.compile.tap('ConsolePlugin',()=>{
            this.beginCompile()
        })
        /**
         * Executed when the compilation has completed. ä¸€æ¬¡ compilation å®Œæˆã€‚
         */
        compiler.hooks.done.tap('ConsolePlugin',()=>{
            this.timer && clearInterval( this.timer )
            const endTime =  new Date().getTime()
            const time = (endTime - this.starTime) / 1000
            console.log( chalk.yellow(' ç¼–è¯‘å®Œæˆ') )
            console.log( chalk.yellow('ç¼–è¯‘ç”¨æ—¶ï¼š' + time + 'ç§’' ) )
        })
    }
    beginCompile(){
       const lineSlog = slog.stdout
       let text  = 'å¼€å§‹ç¼–è¯‘ï¼š'
       /* è®°å½•å¼€å§‹æ—¶é—´ */
       this.starTime =  new Date().getTime()
       this.timer = setInterval(()=>{
          text +=  'â–ˆ'
          lineSlog( chalk.green(text))
       },50)
    }
}
````
**æ„å»ºæ—¶é—´å¦‚ä¸‹ï¼š**


**æ‰“åŒ…åçš„ä½“ç§¯ï¼š**


### ç¿»æ–°è€é¡¹ç›®

é’ˆå¯¹ä¸Šé¢è¿™ä¸ª`react`è€é¡¹ç›®ï¼Œæˆ‘ä»¬å¼€å§‹é’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚ç”±äºæœ¬æ–‡ä¸»è¦è®²çš„æ˜¯`react`ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸æŠŠå¤ªå¤šç¯‡å¹…ç»™`webpackä¼˜åŒ–`ä¸Šã€‚

#### â‘  include æˆ– exclude é™åˆ¶ loader èŒƒå›´ã€‚

````js
{
    test: /\.jsx?$/,
    exclude: /node_modules/,
    include: path.resolve(__dirname, '../src'),
    use:['happypack/loader?id=babel']
    // loader: 'babel-loader'
}
````
#### â‘¡ happypackå¤šè¿›ç¨‹ç¼–è¯‘

é™¤äº†ä¸Šè¿°æ”¹åŠ¨ä¹‹å¤–ï¼Œåœ¨pluginä¸­
````js
/* å¤šçº¿ç¨‹ç¼–è¯‘ */
new HappyPack({
    id:'babel',
    loaders:['babel-loader?cacheDirectory=true']
})
````
#### â‘¢ç¼“å­˜babelç¼–è¯‘è¿‡çš„æ–‡ä»¶

````js
loaders:['babel-loader?cacheDirectory=true']
````

#### â‘£tree Shaking åˆ é™¤å†—ä½™ä»£ç 

#### â‘¤æŒ‰éœ€åŠ è½½ï¼ŒæŒ‰éœ€å¼•å…¥ã€‚


**ä¼˜åŒ–åé¡¹ç›®ç»“æ„**

**ä¼˜åŒ–æ„å»ºæ—¶é—´å¦‚ä¸‹ï¼š**

**ä¼˜åŒ–æ‰“åŒ…åçš„ä½“ç§¯ï¼š**

ç”±æ­¤å¯è§ï¼Œå¦‚æœæˆ‘ä»¬çš„`react`æ˜¯è‡ªå·±å¾’æ‰‹æ­å»ºçš„ï¼Œä¸€äº›ä¼˜åŒ–æŠ€å·§æ˜¾å¾—æ ¼å¤–é‡è¦ã€‚

### å…³äºç±»ä¼¼antd UIåº“çš„ç˜¦èº«æ€è€ƒ

æˆ‘ä»¬åœ¨åš`react`é¡¹ç›®çš„æ—¶å€™ï¼Œä¼šç”¨åˆ°`antd`ä¹‹ç±»çš„uiåº“ï¼Œå€¼å¾—æ€è€ƒçš„ä¸€ä»¶äº‹æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åªæ˜¯ç”¨åˆ°äº†`antd`ä¸­çš„ä¸ªåˆ«ç»„ä»¶ï¼Œæ¯”å¦‚`<Button />  `,å°±è¦æŠŠæ•´ä¸ªæ ·å¼åº“å¼•è¿›æ¥ï¼Œæ‰“åŒ…å°±ä¼šå‘ç°ï¼Œä½“ç§¯å› ä¸ºå¼•å…¥äº†æ•´ä¸ªæ ·å¼å¤§äº†å¾ˆå¤šã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡`.babelrc`å®ç°**æŒ‰éœ€å¼•å…¥**ã€‚


**ç˜¦èº«å‰**

`.babelrc` å¢åŠ å¯¹ `antd` æ ·å¼æŒ‰éœ€å¼•å…¥ã€‚

````js
["import", {
    "libraryName":
    "antd",
    "libraryDirectory": "es",
    "style": true
}]
````

**ç˜¦èº«å**



### æ€»ç»“

å¦‚æœæƒ³è¦ä¼˜åŒ–`react`é¡¹ç›®ï¼Œä»æ„å»ºå¼€å§‹æ˜¯å¿…ä¸å¯å°‘çš„ã€‚æˆ‘ä»¬è¦é‡è§†ä»æ„å»ºåˆ°æ‰“åŒ…ä¸Šçº¿çš„æ¯ä¸€ä¸ªç¯èŠ‚ã€‚

## äºŒ å—æ§æ€§ç»„ä»¶é¢—ç²’åŒ– ï¼Œç‹¬ç«‹è¯·æ±‚æœåŠ¡æ¸²æŸ“å•å…ƒ

å¯æ§æ€§ç»„ä»¶é¢—ç²’åŒ–ï¼Œç‹¬ç«‹è¯·æ±‚æœåŠ¡æ¸²æŸ“å•å…ƒæ˜¯ç¬”è€…åœ¨å®é™…å·¥ä½œæ€»ç»“å‡ºæ¥çš„ç»éªŒã€‚ç›®çš„å°±æ˜¯é¿å…å› è‡ªèº«çš„æ¸²æŸ“æ›´æ–°æˆ–æ˜¯å‰¯ä½œç”¨å¸¦æ¥çš„å…¨å±€é‡æ–°æ¸²æŸ“ã€‚

### 1 é¢—ç²’åŒ–æ§åˆ¶å¯æ§æ€§ç»„ä»¶

å¯æ§æ€§ç»„ä»¶å’Œéå¯æ§æ€§çš„åŒºåˆ«å°±æ˜¯`dom`å…ƒç´ å€¼æ˜¯å¦ä¸å—åˆ°`react`æ•°æ®çŠ¶æ€`state`æ§åˆ¶ã€‚ä¸€æ—¦ç”±`reactçš„state`æ§åˆ¶æ•°æ®çŠ¶æ€ï¼Œæ¯”å¦‚`input`è¾“å…¥æ¡†çš„å€¼ï¼Œå°±ä¼šé€ æˆè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œä¸ºäº†ä½¿`input`å€¼å®æ—¶å˜åŒ–ï¼Œä¼šä¸æ–­`setState`ï¼Œå°±ä¼šä¸æ–­è§¦å‘`render`å‡½æ•°ï¼Œå¦‚æœçˆ¶ç»„ä»¶å†…å®¹ç®€å•è¿˜å¥½ï¼Œå¦‚æœçˆ¶ç»„ä»¶æ¯”è¾ƒå¤æ‚ï¼Œä¼šé€ æˆç‰µä¸€å‘åŠ¨å…¨èº«ï¼Œå¦‚æœå…¶ä»–çš„å­ç»„ä»¶ä¸­`componentWillReceiveProps`è¿™ç§å¸¦æœ‰å‰¯ä½œç”¨çš„é’©å­ï¼Œé‚£ä¹ˆå¼•å‘çš„è´è¶æ•ˆåº”ä¸æ•¢æƒ³è±¡ã€‚æ¯”å¦‚å¦‚ä¸‹`demo`ã€‚


````js
class index extends React.Component<any,any>{
    constructor(props){
        super(props)
        this.state={
            inputValue:''
        }
    }
    handerChange=(e)=> this.setState({ inputValue:e.target.value  })
    render(){
        const { inputValue } = this.state
        return <div>
            { /*  æˆ‘ä»¬å¢åŠ ä¸‰ä¸ªå­ç»„ä»¶ */ }
            <ComA />
            <ComB />
            <ComC />
            <div className="box" >
                <Input  value={inputValue}  onChange={ (e)=> this.handerChange(e) } />
            </div>
            {/* æˆ‘ä»¬é¦–å…ˆæ¥ä¸€ä¸ªåˆ—è¡¨å¾ªç¯ */}
            {
                new Array(10).fill(0).map((item,index)=>{
                    console.log('åˆ—è¡¨å¾ªç¯äº†' )
                    return <div key={index} >{item}</div>
                })
            }
            {
              /* è¿™é‡Œå¯èƒ½æ˜¯æ›´å¤æ‚çš„ç»“æ„ */
              /* ------------------ */
            }
        </div>
    }
}
````

**ç»„ä»¶A**

````js
function index(){
    console.log('ç»„ä»¶Aæ¸²æŸ“')
   return <div>æˆ‘æ˜¯ç»„ä»¶A</div>
}

````


**ç»„ä»¶Bï¼Œæœ‰ä¸€ä¸ªcomponentWillReceivePropsé’©å­**

````js
class Index extends React.Component{
    constructor(props){
        super(props)
    }
    componentWillReceiveProps(){
        console.log('componentWillReceivePropsæ‰§è¡Œ')
        /* å¯èƒ½åšä¸€äº›éªšæ“ä½œ wu lian */
    }
    render(){
        console.log('ç»„ä»¶Bæ¸²æŸ“')
        return <div>
            æˆ‘æ˜¯ç»„ä»¶B
        </div>
    }
}
````

**ç»„ä»¶Cæœ‰ä¸€ä¸ªåˆ—è¡¨å¾ªç¯**

````js
class Index extends React.Component{
    constructor(props){
        super(props)
    }

    render(){
        console.log('ç»„ä»¶cæ¸²æŸ“')
        return <div>
              æˆ‘æ˜¯ç»„ä»¶c
             {
                new Array(10).fill(0).map((item,index)=>{
                    console.log('ç»„ä»¶Cåˆ—è¡¨å¾ªç¯äº†' )
                    return <div key={index} >{item}</div>
                })
            }
        </div>
    }
}
````

å½“æˆ‘ä»¬åœ¨inputè¾“å…¥å†…å®¹çš„æ—¶å€™ã€‚å°±ä¼šé€ æˆå¦‚ä¸Šçš„ç°è±¡ï¼Œæ‰€æœ‰çš„ä¸è¯¥é‡æ–°æ›´æ–°çš„åœ°æ–¹ï¼Œå…¨éƒ¨é‡æ–°æ‰§è¡Œäº†ä¸€éï¼Œè¿™æ— ç–‘æ˜¯å·¨å¤§çš„æ€§èƒ½æŸè€—ã€‚è¿™ä¸ªä¸€ä¸ª`setState`è§¦å‘å¸¦æ¥çš„ä¸€è‚¡å·¨å¤§çš„ç”±æ­¤ç»„ä»¶åˆ°å­ç»„ä»¶å¯èƒ½æ›´æ·±çš„æ›´æ–°æµï¼Œå¸¦æ¥çš„å‰¯ä½œç”¨æ˜¯ä¸å¯ä¼°é‡çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œæ˜¯å¦å°†è¿™ç§å—æ§æ€§ç»„ä»¶é¢—ç²’åŒ–ï¼Œè®©è‡ªå·±æ›´æ–° -> æ¸²æŸ“è¿‡ç¨‹ç”±è‡ªèº«è°ƒåº¦ã€‚

è¯´å¹²å°±å¹²ï¼Œæˆ‘ä»¬å¯¹ä¸Šé¢çš„inputè¡¨å•å•ç‹¬**é¢—ç²’åŒ–**å¤„ç†ã€‚

````js
const ComponentInput = memo(function({ notifyFatherChange }:any){
    const [ inputValue , setInputValue ] = useState('')
    const handerChange = useMemo(() => (e) => {
        setInputValue(e.target.value)
        notifyFatherChange && notifyFatherChange(e.target.value)
    },[])
    return <Input   value={inputValue} onChange={ handerChange  }  />
})
````

æ­¤æ—¶çš„ç»„ä»¶æ›´æ–°ç”±ç»„ä»¶å•å…ƒè‡ªè¡Œæ§åˆ¶ï¼Œä¸éœ€è¦çˆ¶ç»„ä»¶çš„æ›´æ–°ï¼Œæ‰€ä»¥ä¸éœ€è¦çˆ¶ç»„ä»¶è®¾ç½®ç‹¬ç«‹`state`ä¿ç•™çŠ¶æ€ã€‚åªéœ€è¦ç»‘å®šåˆ°`this`ä¸Šå³å¯ã€‚ä¸æ˜¯æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥æ”¾åœ¨ç»„ä»¶çš„ state ä¸­. ä¾‹å¦‚ç¼“å­˜æ•°æ®ã€‚å¦‚æœéœ€è¦ç»„ä»¶å“åº”å®ƒçš„å˜åŠ¨, æˆ–è€…éœ€è¦æ¸²æŸ“åˆ°è§†å›¾ä¸­çš„æ•°æ®æ‰åº”è¯¥æ”¾åˆ° state ä¸­ã€‚è¿™æ ·å¯ä»¥é¿å…ä¸å¿…è¦çš„æ•°æ®å˜åŠ¨å¯¼è‡´ç»„ä»¶é‡æ–°æ¸²æŸ“.

````js
class index extends React.Component<any,any>{   
    formData :any = {}
    render(){
        return <div>
            { /*  æˆ‘ä»¬å¢åŠ ä¸‰ä¸ªå­ç»„ä»¶ */ }
            <ComA />
            <ComB />
            <ComC />
            <div className="box" >
               <ComponentInput notifyFatherChange={ (value)=>{ this.formData.inputValue = value } }  />
               <Button onClick={()=> console.log(this.formData)} >æ‰“å°æ•°æ®</Button>
            </div>
            {/* æˆ‘ä»¬é¦–å…ˆæ¥ä¸€ä¸ªåˆ—è¡¨å¾ªç¯ */}
            {
                new Array(10).fill(0).map((item,index)=>{
                    console.log('åˆ—è¡¨å¾ªç¯äº†' )
                    return <div key={index} >{item}</div>
                })
            }
            {
              /* è¿™é‡Œå¯èƒ½æ˜¯æ›´å¤æ‚çš„ç»“æ„ */
              /* ------------------ */
            }
        </div>
    }
}
````

**æ•ˆæœ**


è¿™æ ·é™¤äº†å½“å‰ç»„ä»¶å¤–ï¼Œå…¶ä»–åœ°æ–¹æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ¸²æŸ“æ³¢åŠ¨ï¼Œè¾¾åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç›®çš„ã€‚


### 2 å»ºç«‹ç‹¬ç«‹çš„è¯·æ±‚æ¸²æŸ“å•å…ƒ

å»ºç«‹ç‹¬ç«‹çš„è¯·æ±‚æ¸²æŸ“å•å…ƒï¼Œç›´æ¥ç†è§£å°±æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æŠŠé¡µé¢ï¼Œåˆ†ä¸ºè¯·æ±‚æ•°æ®å±•ç¤ºéƒ¨åˆ†(é€šè¿‡è°ƒç”¨åç«¯æ¥å£ï¼Œè·å–æ•°æ®)ï¼Œå’ŒåŸºç¡€éƒ¨åˆ†(ä¸éœ€è¦è¯·æ±‚æ•°æ®ï¼Œå·²ç»ç›´æ¥å†™å¥½çš„)ï¼Œå¯¹äºä¸€äº›é€»è¾‘äº¤äº’ä¸æ˜¯å¾ˆå¤æ‚çš„æ•°æ®å±•ç¤ºéƒ¨åˆ†ï¼Œæˆ‘æ¨èç”¨ä¸€ç§ç‹¬ç«‹ç»„ä»¶ï¼Œç‹¬ç«‹è¯·æ±‚æ•°æ®ï¼Œç‹¬ç«‹æ§åˆ¶æ¸²æŸ“çš„æ¨¡å¼ã€‚è‡³äºä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥æ…¢æ…¢åˆ†æã€‚

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ä¼ ç»Ÿçš„é¡µé¢æ¨¡å¼ã€‚

é¡µé¢æœ‰ä¸‰ä¸ªå±•ç¤ºåŒºåŸŸåˆ†åˆ«ï¼Œåšäº†ä¸‰æ¬¡è¯·æ±‚ï¼Œè§¦å‘äº†ä¸‰æ¬¡`setState`,æ¸²æŸ“ä¸‰æ¬¡é¡µé¢ï¼Œå³ä½¿ç”¨`Promise.all`ç­‰æ–¹æ³•ï¼Œä½†æ˜¯ä¹Ÿä¸ä¿è¯æ¥ä¸‹æ¥äº¤äº’ä¸­ï¼Œä¼šæœ‰éƒ¨åˆ†å±•ç¤ºåŒºé‡æ–°æ‹‰åŒºæ•°æ®çš„å¯èƒ½ã€‚ä¸€æ—¦æœ‰ä¸€ä¸ªåŒºåŸŸé‡æ–°æ‹‰å»æ•°æ®ï¼Œå¦å¤–ä¸¤ä¸ªåŒºåŸŸä¹Ÿä¼šè¯´åˆ°ç‰µè¿ï¼Œè¿™ç§æ•ˆåº”æ˜¯ä¸å¯é¿å…çš„ï¼Œå³ä¾¿reactæœ‰å¾ˆå¥½çš„d`diff`ç®—æ³•å»è°ƒåç›¸åŒçš„èŠ‚ç‚¹ï¼Œä½†æ˜¯æ¯”å¦‚é•¿åˆ—è¡¨ç­‰æƒ…å†µï¼Œå¾ªç¯åœ¨æ‰€éš¾å…ã€‚

````js
class Index extends React.Component{
    state :any={
        dataA:null,
        dataB:null,
        dataC:null
    }
    async componentDidMount(){
        /* è·å–AåŒºåŸŸæ•°æ® */
        const dataA = await getDataA()
        this.setState({ dataA })
        /* è·å–BåŒºåŸŸæ•°æ® */
        const dataB = await getDataB()
        this.setState({ dataB })
        /* è·å–CåŒºåŸŸæ•°æ® */
        const dataC = await getDataC()
        this.setState({ dataC })
    }
    render(){
        const { dataA , dataB , dataC } = this.state
        console.log(dataA,dataB,dataC)
        return <div>
            <div> { /* ç”¨ dataA æ•°æ®åšå±•ç¤ºæ¸²æŸ“ */ } </div>
            <div> { /* ç”¨ dataB æ•°æ®åšå±•ç¤ºæ¸²æŸ“ */ } </div>
            <div> { /* ç”¨ dataC æ•°æ®åšå±•ç¤ºæ¸²æŸ“ */ } </div>
        </div>
    }
}
````

æ¥ä¸‹æ¥æˆ‘ä»¬ï¼ŒæŠŠæ¯ä¸€éƒ¨åˆ†æŠ½å–å‡ºæ¥ï¼Œå½¢æˆç‹¬ç«‹çš„æ¸²æŸ“å•å…ƒï¼Œæ¯ä¸ªç»„ä»¶éƒ½ç‹¬ç«‹æ•°æ®è¯·æ±‚åˆ°ç‹¬ç«‹æ¸²æŸ“ã€‚


````js
function ComponentA(){
    const [ dataA, setDataA ] = useState(null)
    useEffect(()=>{
       getDataA().then(res=> setDataA(res.data)  )
    },[])
    return  <div> { /* ç”¨ dataA æ•°æ®åšå±•ç¤ºæ¸²æŸ“ */ } </div>
} 

function ComponentB(){
    const [ dataB, setDataB ] = useState(null)
    useEffect(()=>{
       getDataB().then(res=> setDataB(res.data)  )
    },[])
    return  <div> { /* ç”¨ dataB æ•°æ®åšå±•ç¤ºæ¸²æŸ“ */ } </div>
} 

function ComponentC(){
    const [ dataC, setDataC ] = useState(null)
    useEffect(()=>{
       getDataC().then(res=> setDataC(res.data)  )
    },[])
    return  <div> { /* ç”¨ dataC æ•°æ®åšå±•ç¤ºæ¸²æŸ“ */ } </div>
}  

function Index (){
    return <div>
        <ComponentA />
        <ComponentB />
        <ComponentC />
    </div>
}
````
è¿™æ ·ä¸€æ¥ï¼Œå½¼æ­¤çš„æ•°æ®æ›´æ–°éƒ½ä¸ä¼šç›¸äº’å½±å“ã€‚

#### æ€»ç»“

æ‹†åˆ†éœ€è¦å•ç‹¬è°ƒç”¨åç«¯æ¥å£çš„ç»†å°ç»„ä»¶ï¼Œå»ºç«‹ç‹¬ç«‹çš„æ•°æ®è¯·æ±‚å’Œæ¸²æŸ“ï¼Œè¿™ç§ä¾èµ–æ•°æ®æ›´æ–° -> è§†å›¾æ¸²æŸ“çš„ç»„ä»¶ï¼Œèƒ½ä»æ•´ä¸ªä½“ç³»ä¸­æŠ½ç¦»å‡ºæ¥ ï¼Œå¥½å¤„æˆ‘æ€»ç»“æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ã€‚
  
1 å¯ä»¥é¿å…çˆ¶ç»„ä»¶çš„å†—ä½™æ¸²æŸ“ ï¼Œ`react`çš„æ•°æ®é©±åŠ¨ï¼Œä¾èµ–äº `state` å’Œ `props` çš„æ”¹å˜ï¼Œæ”¹å˜`state `å¿…ç„¶ä¼šå¯¹ç»„ä»¶ `render` å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœçˆ¶ç»„ä»¶ä¸­çš„å­ç»„ä»¶è¿‡äºå¤æ‚ï¼Œä¸€ä¸ªè‡ªç»„ä»¶çš„ `state` æ”¹å˜ï¼Œå°±ä¼šç‰µä¸€å‘åŠ¨å…¨èº«ï¼Œå¿…ç„¶å½±å“æ€§èƒ½ï¼Œæ‰€ä»¥å¦‚æœæŠŠå¾ˆå¤šä¾èµ–è¯·æ±‚çš„ç»„ä»¶æŠ½ç¦»å‡ºæ¥ï¼Œå¯ä»¥ç›´æ¥å‡å°‘æ¸²æŸ“æ¬¡æ•°ã€‚
 
2  å¯ä»¥ä¼˜åŒ–ç»„ä»¶è‡ªèº«æ€§èƒ½ï¼Œæ— è®ºä»`class`å£°æ˜çš„æœ‰çŠ¶æ€ç»„ä»¶è¿˜æ˜¯`fun`å£°æ˜çš„æ— çŠ¶æ€ï¼Œéƒ½æœ‰ä¸€å¥—è‡ªèº«ä¼˜åŒ–æœºåˆ¶ï¼Œæ— è®ºæ˜¯ç”¨`shouldupdate` è¿˜æ˜¯ç”¨ `hooks`ä¸­  `useMemo` `useCallback` ï¼Œéƒ½å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µï¼Œå®šåˆ¶ç¬¦åˆåœºæ™¯çš„æ¸²æ¡
ä»¶ï¼Œä½¿å¾—ä¾èµ–æ•°æ®è¯·æ±‚ç»„ä»¶å½¢æˆè‡ªå·±ä¸€ä¸ªå°çš„ï¼Œé€‚åˆè‡ªèº«çš„æ¸²æŸ“ç¯å¢ƒã€‚
 
3 èƒ½å¤Ÿå’Œ`redux` ,ä»¥åŠ`redux`è¡ç”Ÿå‡ºæ¥ `redux-action` , `dva`,æ›´åŠ å¥‘åˆçš„å·¥ä½œï¼Œç”¨ `connect` åŒ…è£¹çš„ç»„ä»¶ï¼Œå°±èƒ½é€šè¿‡åˆ¶å®šå¥½çš„å¥‘çº¦ï¼Œæ ¹æ®æ‰€éœ€æ±‚çš„æ•°æ®æ›´æ–°ï¼Œè€Œæ›´æ–°è‡ªèº«ï¼Œè€ŒæŠŠè¿™ç§æ¨¡å¼ç”¨åœ¨è¿™ç§å°çš„ï¼Œéœ€è¦æ•°æ®é©±åŠ¨çš„ç»„ä»¶ä¸Šï¼Œå°±ä¼šèµ·åˆ°ç‰©å°½å…¶ç”¨çš„æ•ˆæœã€‚

## ä¸‰ è·¯ç”±æ‡’åŠ è½½ï¼Œè·¯ç”±ç›‘å¬å™¨

`react`è·¯ç”±æ‡’åŠ è½½ï¼Œæ˜¯ç¬”è€…çœ‹å®Œ`dva`æºç ä¸­çš„ `dynamic`å¼‚æ­¥åŠ è½½ç»„ä»¶æ€»ç»“å‡ºæ¥çš„ï¼Œé’ˆå¯¹å¤§å‹é¡¹ç›®æœ‰å¾ˆå¤šé¡µé¢ï¼Œåœ¨é…ç½®è·¯ç”±çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰å¯¹è·¯ç”±è¿›è¡Œå¤„ç†ï¼Œä¸€æ¬¡æ€§ä¼šåŠ è½½å¤§é‡è·¯ç”±ï¼Œè¿™å¯¹é¡µé¢åˆå§‹åŒ–å¾ˆä¸å‹å¥½ï¼Œä¼šå»¶é•¿é¡µé¢åˆå§‹åŒ–æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è¿™ç”¨`asyncRouter`æ¥æŒ‰éœ€åŠ è½½é¡µé¢è·¯ç”±ã€‚

### ä¼ ç»Ÿè·¯ç”±

å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç”¨`umi`ç­‰æ¡†æ¶ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®è·¯ç”±çš„æ—¶å€™ï¼Œä¹Ÿè®¸è·¯ç”±ä¼šè¿™æ ·é…ç½®ã€‚
````js
<Switch>
    <Route path={'/index'} component={Index} ></Route>
    <Route path={'/list'} component={List} ></Route>
    <Route path={'/detail'} component={ Detail } ></Route>
    <Redirect from='/*' to='/index' />
</Switch>
````
æˆ–è€…ç”¨listä¿å­˜è·¯ç”±ä¿¡æ¯ï¼Œæ–¹ä¾¿åœ¨è¿›è¡Œè·¯ç”±æ‹¦æˆªï¼Œæˆ–è€…é…ç½®è·¯ç”±èœå•ç­‰ã€‚

````js
const router = [
    {
        'path': '/index',
        'component': Index
    },
    {
        'path': '/list'',
        'component': List
    },
    {
        'path': '/detail',
        'component': Detail
    },
]
````

### asyncRouteræ‡’åŠ è½½è·¯ç”±,å¹¶å®ç°è·¯ç”±ç›‘å¬

 æˆ‘ä»¬ä»Šå¤©è®²çš„è¿™ç§`react`è·¯ç”±æ‡’åŠ è½½æ˜¯åŸºäº`import` å‡½æ•°è·¯ç”±æ‡’åŠ è½½ï¼Œ ä¼—æ‰€å‘¨çŸ¥ ï¼Œ`import` æ‰§è¡Œä¼šè¿”å›ä¸€ä¸ª`Promise`ä½œä¸ºå¼‚æ­¥åŠ è½½çš„æ‰‹æ®µã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ç‚¹æ¥å®ç°`react`å¼‚æ­¥åŠ è½½è·¯ç”±

 å¥½çš„ä¸€è¨€ä¸åˆä¸Šä»£ç ã€‚ã€‚ã€‚

**ä»£ç **

````js
const routerObserveQueue = [] /* å­˜æ”¾è·¯ç”±å«è§†é’©å­ */
/* æ‡’åŠ è½½è·¯ç”±å«å£«é’©å­ */
export const RouterHooks = {
  /* è·¯ç”±ç»„ä»¶åŠ è½½ä¹‹å‰ */
  beforeRouterComponentLoad: function(callback) {
    routerObserveQueue.push({
      type: 'before',
      callback
    })
  },
  /* è·¯ç”±ç»„ä»¶åŠ è½½ä¹‹å */
  afterRouterComponentDidLoaded(callback) {
    routerObserveQueue.push({
      type: 'after',
      callback
    })
  }
}
/* è·¯ç”±æ‡’åŠ è½½HOC */
export default function AsyncRouter(loadRouter) {
  return class Content extends React.Component {
    constructor(props) {
      super(props)
      /* è§¦å‘æ¯ä¸ªè·¯ç”±åŠ è½½ä¹‹å‰é’©å­å‡½æ•° */
      this.dispatchRouterQueue('before')
    }
    state = {Component: null}
    dispatchRouterQueue(type) {
      const {history} = this.props
      routerObserveQueue.forEach(item => {
        if (item.type === type) item.callback(history)
      })
    }
    componentDidMount() {
      if (this.state.Component) return
      loadRouter()
        .then(module => module.default)
        .then(Component => this.setState({Component},
          () => {
            /* è§¦å‘æ¯ä¸ªè·¯ç”±åŠ è½½ä¹‹åé’©å­å‡½æ•° */
            this.dispatchRouterQueue('after')
          }))
    }
    render() {
      const {Component} = this.state
      return Component ? <Component {
      ...this.props
      }
      /> : null
    }
  }
}

````
`asyncRouter`å®é™…å°±æ˜¯ä¸€ä¸ªé«˜çº§ç»„ä»¶,å°†`()=>import()`ä½œä¸ºåŠ è½½å‡½æ•°ä¼ è¿›æ¥ï¼Œç„¶åå½“å¤–éƒ¨`Route`åŠ è½½å½“å‰ç»„ä»¶çš„æ—¶å€™ï¼Œåœ¨`componentDidMount`ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼ŒåŠ è½½çœŸå®çš„ç»„ä»¶ï¼Œå¹¶æ¸²æŸ“ç»„ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†™é’ˆå¯¹è·¯ç”±æ‡’åŠ è½½çŠ¶æ€å®šåˆ¶å±äºè‡ªå·±çš„è·¯ç”±ç›‘å¬å™¨`beforeRouterComponentLoad`å’Œ`afterRouterComponentDidLoaded`ï¼Œç±»ä¼¼`vue`ä¸­` watch $route` åŠŸèƒ½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ã€‚

**ä½¿ç”¨**

````js
import AsyncRouter ,{ RouterHooks }  from './asyncRouter.js'
const { beforeRouterComponentLoad} = RouterHooks
const Index = AsyncRouter(()=>import('../src/page/home/index'))
const List = AsyncRouter(()=>import('../src/page/list'))
const Detail = AsyncRouter(()=>import('../src/page/detail'))
const index = () => {
  useEffect(()=>{
    /* å¢åŠ ç›‘å¬å‡½æ•° */  
    beforeRouterComponentLoad((history)=>{
      console.log('å½“å‰æ¿€æ´»çš„è·¯ç”±æ˜¯',history.location.pathname)
    })
  },[])
  return <div >
    <div >
      <Router  >
      <Meuns/>
      <Switch>
          <Route path={'/index'} component={Index} ></Route>
          <Route path={'/list'} component={List} ></Route>
          <Route path={'/detail'} component={ Detail } ></Route>
          <Redirect from='/*' to='/index' />
       </Switch>
      </Router>
    </div>
  </div>
}
````
**æ•ˆæœ**

è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬æ—¢åšåˆ°äº†è·¯ç”±çš„æ‡’åŠ è½½ï¼Œåˆå¼¥è¡¥äº†`react-router`æ²¡æœ‰ç›‘å¬å½“å‰è·¯ç”±å˜åŒ–çš„ç›‘å¬å‡½æ•°çš„ç¼ºé™·ã€‚


## å›› shouldComponentUpdate ,PureComponent å’Œ React.memo ,immetable.js åŠ©åŠ›æ€§èƒ½è°ƒä¼˜

åœ¨è¿™é‡Œæˆ‘ä»¬æ‹¿`immetable.js`ä¸ºä¾‹ï¼Œè®²æœ€ä¼ ç»Ÿçš„é™åˆ¶æ›´æ–°æ–¹æ³•ï¼Œç¬¬å…­éƒ¨åˆ†å°†è¦å°†ä¸€äº›é¿å…é‡æ–°æ¸²æŸ“çš„ç»†èŠ‚ã€‚


### PureComponent å’Œ React.memo
`React.PureComponent  `ä¸ `React.Component` ç”¨æ³•å·®ä¸å¤š ,ä½†` React.PureComponent` é€šè¿‡propså’Œstateçš„æµ…å¯¹æ¯”æ¥å®ç° `shouldComponentUpate()`ã€‚å¦‚æœå¯¹è±¡åŒ…å«å¤æ‚çš„æ•°æ®ç»“æ„(æ¯”å¦‚å¯¹è±¡å’Œæ•°ç»„)ï¼Œä»–ä¼šæµ…æ¯”è¾ƒï¼Œå¦‚æœæ·±å±‚æ¬¡çš„æ”¹å˜ï¼Œæ˜¯æ— æ³•ä½œå‡ºåˆ¤æ–­çš„ï¼Œ`React.PureComponent` è®¤ä¸ºæ²¡æœ‰å˜åŒ–ï¼Œè€Œæ²¡æœ‰æ¸²æŸ“è¯•å›¾ã€‚

å¦‚è¿™ä¸ªä¾‹å­

````js
class Text extends React.PureComponent<any,any>{
    render(){
        console.log(this.props)
        return <div>hello,wrold</div>
    }
}
class Index extends React.Component<any,any>{
    state={
        data:{ a : 1 , b : 2 }
    }
    handerClick=()=>{
        const { data } = this.state
        data.a++
        this.setState({ data })
    }
    render(){
        const { data } = this.state
        return <div>
            <button onClick={ this.handerClick } >ç‚¹å‡»</button>
            <Text data={data} />
        </div>
    }
}
````

**æ•ˆæœ**

æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œå‘ç° `<Text />` æ ¹æœ¬æ²¡æœ‰é‡æ–°æ›´æ–°ã€‚è¿™é‡Œè™½ç„¶æ”¹äº†`data`ä½†æ˜¯åªæ˜¯æ”¹å˜äº†`data`ä¸‹çš„å±æ€§ï¼Œæ‰€ä»¥ `PureComponent` è¿›è¡Œæµ…æ¯”è¾ƒä¸ä¼š`update`ã€‚

æƒ³è¦è§£å†³è¿™ä¸ªé—®é¢˜å®é™…ä¹Ÿå¾ˆå®¹æ˜“ã€‚

````js
 <Text data={{ ...data }} />
````

æ— è®ºç»„ä»¶æ˜¯å¦æ˜¯ `PureComponent`ï¼Œå¦‚æœå®šä¹‰äº† `shouldComponentUpdate()`ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨å®ƒå¹¶ä»¥å®ƒçš„æ‰§è¡Œç»“æœæ¥åˆ¤æ–­æ˜¯å¦ `update`ã€‚åœ¨ç»„ä»¶æœªå®šä¹‰ `shouldComponentUpdate()` çš„æƒ…å†µä¸‹ï¼Œä¼šåˆ¤æ–­è¯¥ç»„ä»¶æ˜¯å¦æ˜¯ `PureComponent`ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä¼šå¯¹æ–°æ—§ `propsã€state` è¿›è¡Œ `shallowEqual` æ¯”è¾ƒï¼Œä¸€æ—¦æ–°æ—§ä¸ä¸€è‡´ï¼Œä¼šè§¦å‘æ¸²æŸ“æ›´æ–°ã€‚

`react.memo` å’Œ `PureComponent` åŠŸèƒ½ç±»ä¼¼ ï¼Œ`react.memo` ä½œä¸ºç¬¬ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•° å¯ä»¥å¯¹`props` è¿›è¡Œæ¯”è¾ƒ ï¼Œå’Œ`shouldComponentUpdate`ä¸åŒçš„, å½“ç¬¬äºŒä¸ªå‚æ•°è¿”å› `true` çš„æ—¶å€™ï¼Œè¯æ˜`props`æ²¡æœ‰æ”¹å˜ï¼Œä¸æ¸²æŸ“ç»„ä»¶ï¼Œåä¹‹æ¸²æŸ“ç»„ä»¶ã€‚

### shouldComponentUpdate

ä½¿ç”¨ `shouldComponentUpdate()  `ä»¥è®©`React`çŸ¥é“å½“`stateæˆ–props`çš„æ”¹å˜æ˜¯å¦å½±å“ç»„ä»¶çš„é‡æ–°`render`ï¼Œé»˜è®¤è¿”å›`ture`ï¼Œè¿”å›`false`æ—¶ä¸ä¼šé‡æ–°æ¸²æŸ“æ›´æ–°ï¼Œè€Œä¸”è¯¥æ–¹æ³•å¹¶ä¸ä¼šåœ¨åˆå§‹åŒ–æ¸²æŸ“æˆ–å½“ä½¿ç”¨ `forceUpdate()` æ—¶è¢«è°ƒç”¨ï¼Œé€šå¸¸ä¸€ä¸ª`shouldComponentUpdate` åº”ç”¨æ˜¯è¿™ä¹ˆå†™çš„ã€‚


**æ§åˆ¶çŠ¶æ€**
````js
shouldComponentUpdate(nextProps, nextState) {
  /* å½“ state ä¸­ data1 å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°æ›´æ–°ç»„ä»¶ */  
  return nextState.data1 !== this.state.data1
}
````
è¿™ä¸ªçš„æ„æ€å°±æ˜¯ ä»…å½“`state` ä¸­ `data1` å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°æ›´æ–°ç»„ä»¶ã€‚
**æ§åˆ¶propå±æ€§**
````js
shouldComponentUpdate(nextProps, nextState) {
  /* å½“ props ä¸­ data2å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°æ›´æ–°ç»„ä»¶ */  
  return nextProps.data2 !== this.props.data2
}
````
è¿™ä¸ªçš„æ„æ€å°±æ˜¯ ä»…å½“`props` ä¸­ `data2` å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé‡æ–°æ›´æ–°ç»„ä»¶ã€‚

### immetable.js

`immetable.js` æ˜¯Facebook å¼€å‘çš„ä¸€ä¸ª`js`åº“ï¼Œå¯ä»¥æé«˜å¯¹è±¡çš„æ¯”è¾ƒæ€§èƒ½ï¼Œåƒä¹‹å‰æ‰€è¯´çš„`pureComponent` åªèƒ½å¯¹å¯¹è±¡è¿›è¡Œæµ…æ¯”è¾ƒï¼Œ,å¯¹äºå¯¹è±¡çš„æ•°æ®ç±»å‹,å´æŸæ‰‹æ— ç­–,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ `immetable.js` é…åˆ `shouldComponentUpdate` æˆ–è€…  `react.memo`æ¥ä½¿ç”¨ã€‚`immutable` ä¸­

æˆ‘ä»¬ç”¨`react-redux`æ¥ç®€å•ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹æ‰€ç¤º æ•°æ®éƒ½å·²ç»è¢« `immetable.js`å¤„ç†ã€‚

````js
import { is  } from 'immutable'
const GoodItems = connect(state =>
    ({ GoodItems: filter(state.getIn(['Items', 'payload', 'list']), state.getIn(['customItems', 'payload', 'list'])) || Immutable.List(), })
    /* æ­¤å¤„çœç•¥å¾ˆå¤šä»£ç ï½ï½ï½ï½ï½ï½ */
)(memo(({ Items, dispatch, setSeivceId }) => {
   /*  */
}, (pre, next) => is(pre.Items, next.Items)))

````

é€šè¿‡ `is` æ–¹æ³•æ¥åˆ¤æ–­ï¼Œå‰å`Items`(å¯¹è±¡æ•°æ®ç±»å‹)æ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚

## äº” è§„èŒƒå†™æ³•ï¼Œåˆç†å¤„ç†ç»†èŠ‚é—®é¢˜

æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨æ•²ä»£ç çš„æ—¶å€™ï¼Œç¨å¾®æ³¨æ„ä»¥ä¸‹ï¼Œå°±èƒ½é¿å…æ€§èƒ½çš„å¼€é”€ã€‚ä¹Ÿè®¸åªæ˜¯ç¨åŠ æ”¹åŠ¨ï¼Œå°±èƒ½å…¶ä»–ä¼˜åŒ–æ€§èƒ½çš„æ•ˆæœã€‚

### â‘ ç»‘å®šäº‹ä»¶å°½é‡ä¸è¦ä½¿ç”¨ç®­å¤´å‡½æ•°


#### é¢ä¸´é—®é¢˜
ä¼—æ‰€å‘¨çŸ¥ï¼Œ`react`æ›´æ–°æ¥å¤§éƒ¨åˆ†æƒ…å†µè‡ªäº`props`çš„æ”¹å˜(è¢«åŠ¨æ¸²æŸ“)ï¼Œå’Œ`state`æ”¹å˜(ä¸»åŠ¨æ¸²æŸ“)ã€‚å½“æˆ‘ä»¬ç»™æœªåŠ ä»»ä½•æ›´æ–°é™å®šæ¡ä»¶å­ç»„ä»¶ç»‘å®šäº‹ä»¶çš„æ—¶å€™ï¼Œæˆ–è€…æ˜¯`PureComponent` çº¯ç»„ä»¶ï¼Œ å¦‚æœæˆ‘ä»¬ç®­å¤´å‡½æ•°ä½¿ç”¨çš„è¯ã€‚

````js
<ChildComponent handerClick={()=>{ console.log(666) }}  />
````
æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¤„ç†å™¨ï¼Œè¿™ä¼šå¯¼è‡´ `ChildComponent`  æ¯æ¬¡éƒ½ä¼šè¢«æ¸²æŸ“ã€‚

å³ä¾¿æˆ‘ä»¬ç”¨ç®­å¤´å‡½æ•°ç»‘å®šç»™`dom`å…ƒç´ ã€‚

````jsx
<div onClick={ ()=>{ console.log(777) } } >hello,world</div>
````
æ¯æ¬¡`react`åˆæˆäº‹ä»¶äº‹ä»¶çš„æ—¶å€™ï¼Œä¹Ÿéƒ½ä¼šé‡æ–°å£°æ˜ä¸€ä¸ªæ–°äº‹ä»¶ã€‚

#### è§£å†³é—®é¢˜

è§£å†³è¿™ä¸ªé—®é¢˜äº‹ä»¶å¾ˆç®€å•ï¼Œåˆ†ä¸ºæ— çŠ¶æ€ç»„ä»¶å’Œæœ‰çŠ¶æ€ç»„ä»¶ã€‚

**æœ‰çŠ¶æ€ç»„ä»¶**

````js
class index extends React.Component{
    handerClick=()=>{
        console.log(666)
    }
    handerClick1=()=>{
        console.log(777)
    }
    render(){
        return <div>
            <ChildComponent handerClick={ this.handerClick }  />
            <div onClick={ this.handerClick1 }  >hello,world</div>
        </div>
    }
}
````

**æ— çŠ¶æ€ç»„ä»¶**

````js
function index(){
   
    const handerClick1 = useMemo(()=>()=>{
       console.log(777)
    },[])  /* [] å­˜åœ¨å½“å‰ handerClick1 çš„ä¾èµ–é¡¹*/
    const handerClick = useCallback(()=>{ console.log(666) },[])  /* [] å­˜åœ¨å½“å‰ handerClick çš„ä¾èµ–é¡¹*/
    return <div>
        <ChildComponent handerClick={ handerClick }  />
        <div onClick={ handerClick1 }  >hello,world</div>
    </div>
}
````

å¯¹äº`dom`ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦ä¼ é€’å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ã€‚

````js
function index(){
    const handerClick1 = useMemo(()=>(event)=>{
        const mes = event.currentTarget.dataset.mes
        console.log(mes) /* hello,world */
    },[])
    return <div>
        <div  data-mes={ 'hello,world' } onClick={ handerClick1 }  >hello,world</div>
    </div>
}
````

### â‘¡å¾ªç¯æ­£ç¡®ä½¿ç”¨key

æ— è®ºæ˜¯`react` å’Œ `vue`,æ­£ç¡®ä½¿ç”¨`key`,ç›®çš„å°±æ˜¯åœ¨ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œæ‰¾åˆ°ä¸æ–°èŠ‚ç‚¹å¯¹åº”çš„è€èŠ‚ç‚¹ï¼Œå¤ç”¨èŠ‚ç‚¹ï¼ŒèŠ‚çœå¼€é”€ã€‚æƒ³æ·±å…¥ç†è§£çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹ç¬”è€…çš„å¦å¤–ä¸€ç¯‡æ–‡ç«  [å…¨é¢è§£æ vue3.0 diffç®—æ³•](https://juejin.cn/post/6861960532048642061) é‡Œé¢æœ‰å¯¹`key`è¯¦ç»†è¯´æ˜ã€‚æˆ‘ä»¬ä»Šå¤©æ¥çœ‹ä»¥ä¸‹`key`æ­£ç¡®ç”¨æ³•,å’Œé”™è¯¯ç”¨æ³•ã€‚

#### 1 é”™è¯¯ç”¨æ³•

**é”™è¯¯ç”¨æ³•ä¸€ï¼šç”¨indexåškey**

````js
function index(){
    const list = [ { id:1 , name:'å“ˆå“ˆ' } , { id:2, name:'å˜¿å˜¿' } ,{ id:3 , name:'å˜»å˜»' } ]
    return <div>
       <ul>
         {  list.map((item,index)=><li key={index} >{ item.name }</li>)  }
       </ul>
    </div>
}
````
è¿™ç§åŠ `key`çš„æ€§èƒ½,å®é™…å’Œä¸åŠ `key`æ•ˆæœå·®ä¸å¤šï¼Œæ¯æ¬¡è¿˜æ˜¯ä»å¤´åˆ°å°¾diffã€‚


**é”™è¯¯ç”¨æ³•äºŒ:ç”¨indexæ‹¼æ¥å…¶ä»–çš„å­—æ®µ**
````js
function index(){
    const list = [ { id:1 , name:'å“ˆå“ˆ' } , { id:2, name:'å˜¿å˜¿' } ,{ id:3 , name:'å˜»å˜»' } ]
    return <div>
       <ul>
         {  list.map((item,index)=><li key={index + item.name } >{ item.name }</li>)  }
       </ul>
    </div>
}
````
å¦‚æœæœ‰å…ƒç´ ç§»åŠ¨æˆ–è€…åˆ é™¤ï¼Œé‚£ä¹ˆå°±å¤±å»äº†ä¸€ä¸€å¯¹åº”å…³ç³»ï¼Œå‰©ä¸‹çš„èŠ‚ç‚¹éƒ½ä¸èƒ½æœ‰æ•ˆå¤ç”¨ã€‚

#### 2 æ­£ç¡®ç”¨æ³•

**æ­£ç¡®ç”¨æ³•ï¼šç”¨å”¯ä¸€idä½œä¸ºkey**
````js
function index(){
    const list = [ { id:1 , name:'å“ˆå“ˆ' } , { id:2, name:'å˜¿å˜¿' } ,{ id:3 , name:'å˜»å˜»' } ]
    return <div>
       <ul>
         {  list.map((item,index)=><li key={ item.id } >{ item.name }</li>)  }
       </ul>
    </div>
}
````
ç”¨å”¯ä¸€çš„å¥`id`ä½œä¸º`key`,èƒ½å¤Ÿåšåˆ°æœ‰æ•ˆå¤ç”¨å…ƒç´ èŠ‚ç‚¹ã€‚


### â‘¢æ— çŠ¶æ€ç»„ä»¶`hooks-useMemo` é¿å…é‡å¤å£°æ˜ã€‚

å¯¹äºæ— çŠ¶æ€ç»„ä»¶ï¼Œæ•°æ®æ›´æ–°å°±ç­‰äºå‡½æ•°ä¸Šä¸‹æ–‡çš„é‡å¤æ‰§è¡Œã€‚é‚£ä¹ˆå‡½æ•°é‡Œé¢çš„å˜é‡ï¼Œæ–¹æ³•å°±ä¼šé‡æ–°å£°æ˜ã€‚æ¯”å¦‚å¦‚ä¸‹æƒ…å†µã€‚

````js
function Index(){
    const [ number , setNumber  ] = useState(0)
    const handerClick1 = ()=>{
        /* ä¸€äº›æ“ä½œ */
    }
    const handerClick2 = ()=>{
        /* ä¸€äº›æ“ä½œ */
    }
    const handerClick3 = ()=>{
        /* ä¸€äº›æ“ä½œ */
    }
    return <div>
        <a onClick={ handerClick1 } >ç‚¹æˆ‘æœ‰æƒŠå–œ1</a>
        <a onClick={ handerClick2 } >ç‚¹æˆ‘æœ‰æƒŠå–œ2</a>
        <a onClick={ handerClick3 } >ç‚¹æˆ‘æœ‰æƒŠå–œ3</a>
        <button onClick={ ()=> setNumber(number+1) } > ç‚¹å‡» { number } </button>
    </div>
}
````
æ¯æ¬¡ç‚¹å‡»`button`çš„æ—¶å€™,éƒ½ä¼šæ‰§è¡Œ`Index`å‡½æ•°ã€‚`handerClick1` , `handerClick2`,`handerClick3`éƒ½ä¼šé‡æ–°å£°æ˜ã€‚ä¸ºäº†é¿å…è¿™ä¸ªæƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `useMemo` åšç¼“å­˜ï¼Œæˆ‘ä»¬å¯ä»¥æ”¹æˆå¦‚ä¸‹ã€‚

````js
function Index(){
    const [ number , setNumber  ] = useState(0)
    const [ handerClick1 , handerClick2  ,handerClick3] = useMemo(()=>{
        const fn1 = ()=>{
            /* ä¸€äº›æ“ä½œ */
        }
        const fn2 = ()=>{
            /* ä¸€äº›æ“ä½œ */
        }
        const  fn3= ()=>{
            /* ä¸€äº›æ“ä½œ */
        }
        return [fn1 , fn2 ,fn3]
    },[]) /* åªæœ‰å½“æ•°æ®é‡Œé¢çš„ä¾èµ–é¡¹ï¼Œå‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ‰ä¼šé‡æ–°å£°æ˜å‡½æ•°ã€‚ */
    return <div>
        <a onClick={ handerClick1 } >ç‚¹æˆ‘æœ‰æƒŠå–œ1</a>
        <a onClick={ handerClick2 } >ç‚¹æˆ‘æœ‰æƒŠå–œ2</a>
        <a onClick={ handerClick3 } >ç‚¹æˆ‘æœ‰æƒŠå–œ3</a>
        <button onClick={ ()=> setNumber(number+1) } > ç‚¹å‡» { number } </button>
    </div>
}
````
å¦‚ä¸‹æ”¹å˜ä¹‹åï¼Œ`handerClick1` , `handerClick2`,`handerClick3` ä¼šè¢«ç¼“å­˜ä¸‹æ¥ã€‚

### â‘£æ‡’åŠ è½½ Suspense å’Œ lazy

`Suspense` å’Œ `lazy` å¯ä»¥å®ç° `dynamic import` æ‡’åŠ è½½æ•ˆæœï¼ŒåŸç†å’Œä¸Šè¿°çš„è·¯ç”±æ‡’åŠ è½½å·®ä¸å¤šã€‚åœ¨ `React` ä¸­çš„ä½¿ç”¨æ–¹æ³•æ˜¯åœ¨ `Suspense` ç»„ä»¶ä¸­ä½¿ç”¨ `<LazyComponent> ` ç»„ä»¶ã€‚

````js
const LazyComponent = React.lazy(() => import('./LazyComponent'));

function demo () {
  return (
    <div>
      <Suspense fallback={<div>Loading...</div>}>
        <LazyComponent />
      </Suspense>
    </div>
  )
}
````

`LazyComponent` æ˜¯é€šè¿‡æ‡’åŠ è½½åŠ è½½è¿›æ¥çš„ï¼Œæ‰€ä»¥æ¸²æŸ“é¡µé¢çš„æ—¶å€™å¯èƒ½ä¼šæœ‰å»¶è¿Ÿï¼Œä½†ä½¿ç”¨äº† `Suspense` ä¹‹åï¼Œåœ¨åŠ è½½çŠ¶æ€ä¸‹ï¼Œå¯ä»¥ç”¨`<div>Loading...</div>`ä½œä¸º`loading`æ•ˆæœã€‚

`Suspense` å¯ä»¥åŒ…è£¹å¤šä¸ªæ‡’åŠ è½½ç»„ä»¶ã€‚

````js
<Suspense fallback={<div>Loading...</div>}>
    <LazyComponent />
    <LazyComponent1 />
</Suspense>

````

## å…­ å¤šç§æ–¹å¼é¿å…é‡å¤æ¸²æŸ“

**é¿å…é‡å¤æ¸²æŸ“**,æ˜¯`react`æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æ–¹å‘ã€‚å¦‚æœæƒ³å°½å¿ƒå°½åŠ›å¤„ç†å¥½`react`é¡¹ç›®æ¯ä¸€ä¸ªç»†èŠ‚ï¼Œé‚£ä¹ˆå°±è¦ä»æ¯ä¸€è¡Œä»£ç å¼€å§‹ï¼Œä»æ¯ä¸€ç»„ä»¶å¼€å§‹ã€‚æ­£æ‰€è°“ä¸ç§¯ç¡…æ­¥æ— ä»¥è‡³åƒé‡Œã€‚

### â‘  å­¦ä¼šä½¿ç”¨çš„æ‰¹é‡æ›´æ–°


#### æ‰¹é‡æ›´æ–°
è¿™æ¬¡è®²çš„æ‰¹é‡æ›´æ–°çš„æ¦‚å¿µï¼Œå®é™…ä¸»è¦æ˜¯é’ˆå¯¹æ— çŠ¶æ€ç»„ä»¶å’Œ`hooks`ä¸­`useState`,å’Œ `class`æœ‰çŠ¶æ€ç»„ä»¶ä¸­çš„`this.setState`ï¼Œä¸¤ç§æ–¹æ³•å·²ç»åšäº†æ‰¹é‡æ›´æ–°çš„å¤„ç†ã€‚æ¯”å¦‚å¦‚ä¸‹ä¾‹å­

**ä¸€æ¬¡æ›´æ–°ä¸­**
````js
class index extends React.Component{
    constructor(prop){
        super(prop)
        this.state = {
            a:1,
            b:2,
            c:3,
        }
    }
    handerClick=()=>{
        const { a,b,c } :any = this.state
        this.setState({ a:a+1 })
        this.setState({ b:b+1 })
        this.setState({ c:c+1 })
    }
    render= () => <div onClick={this.handerClick} />
}
````
ç‚¹å‡»äº‹ä»¶å‘ç”Ÿä¹‹åï¼Œä¼šè§¦å‘ä¸‰æ¬¡ `setState`,ä½†æ˜¯ä¸ä¼šæ¸²æŸ“ä¸‰æ¬¡ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªæ‰¹é‡æ›´æ–°`batchUpdate`æ‰¹é‡æ›´æ–°çš„æ¦‚å¿µã€‚ä¸‰æ¬¡`setState`æœ€åè¢«åˆæˆç±»ä¼¼å¦‚ä¸‹æ ·å­

````js
this.setState({
    a:a+1 ,
    b:b+1 ,
    c:c+1 
})
````
**æ— çŠ¶æ€ç»„ä»¶ä¸­**

````js
    const  [ a , setA ] = useState(1)
    const  [ b , setB ] = useState({})
    const  [ c , setC ] = useState(1)
    const handerClick = () => {
        setB( { ...b } ) 
        setC( c+1 ) 
        setA( a+1 )
    }
````

#### æ‰¹é‡æ›´æ–°å¤±æ•ˆ

å½“æˆ‘ä»¬é’ˆå¯¹ä¸Šè¿°ä¸¤ç§æƒ…å†µåŠ ä»¥å¦‚ä¸‹å¤„ç†ä¹‹åã€‚

````js
handerClick=()=>{
    setTimeout(() => {
        this.setState({ a:a+1 })
        this.setState({ b:b+1 })
        this.setState({ c:c+1 })
    }, 0)
}
````

````js
 const handerClick = () => {
    Promise.resolve().then(()=>{
    setB( { ...b } ) 
    setC( c+1 ) 
    setA( a+1 )
    })
}
````
æˆ‘ä»¬ä¼šå‘ç°ï¼Œä¸Šè¿°ä¸¤ç§æƒ…å†µ ï¼Œç»„ä»¶éƒ½æ›´æ–°æ¸²æŸ“äº†ä¸‰æ¬¡ ï¼Œæ­¤æ—¶çš„æ‰¹é‡æ›´æ–°å¤±æ•ˆäº†ã€‚è¿™ç§æƒ…å†µåœ¨`react-hooks`ä¸­ä¹Ÿæ™®éå­˜åœ¨ï¼Œè¿™ç§æƒ…å†µç”šè‡³åœ¨`hooks`ä¸­æ›´åŠ æ˜æ˜¾ï¼Œå› ä¸ºæˆ‘ä»¬éƒ½çŸ¥é“`hooks`ä¸­æ¯ä¸ª`useState`ä¿å­˜äº†ä¸€ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸æ˜¯è®©`class`å£°æ˜ç»„ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡`this.state`ç»Ÿä¸€åè°ƒçŠ¶æ€ï¼Œå†ä¸€æ¬¡å¼‚æ­¥å‡½æ•°ä¸­ï¼Œæ¯”å¦‚è¯´ä¸€æ¬¡`ajax`è¯·æ±‚åï¼Œæƒ³é€šè¿‡å¤šä¸ª`useState`æ”¹å˜çŠ¶æ€ï¼Œä¼šé€ æˆå¤šæ¬¡æ¸²æŸ“é¡µé¢ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ‰¹é‡æ›´æ–°ã€‚

#### æ‰‹åŠ¨æ‰¹é‡æ›´æ–°

`react-dom` ä¸­æä¾›äº†`unstable_batchedUpdates`æ–¹æ³•è¿›è¡Œæ‰‹åŠ¨æ‰¹é‡æ›´æ–°ã€‚è¿™ä¸ª`api`æ›´å¥‘åˆ`react-hooks`ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšã€‚

````js
 const handerClick = () => {
    Promise.resolve().then(()=>{
        unstable_batchedUpdates(()=>{
            setB( { ...b } ) 
            setC( c+1 ) 
            setA( a+1 )
        })
    })
}
````
è¿™æ ·ä¸‰æ¬¡æ›´æ–°ï¼Œå°±ä¼šåˆå¹¶æˆä¸€æ¬¡ã€‚åŒæ ·è¾¾åˆ°äº†æ‰¹é‡æ›´æ–°çš„æ•ˆæœã€‚


### â‘¡ åˆå¹¶state

#### classç±»ç»„ä»¶(æœ‰çŠ¶æ€ç»„ä»¶)
åˆå¹¶`state`è¿™ç§ï¼Œæ˜¯ä¸€ç§æˆ‘ä»¬åœ¨`react`é¡¹ç›®å¼€å‘ä¸­è¦å…»æˆçš„ä¹ æƒ¯ã€‚æˆ‘çœ‹è¿‡æœ‰äº›åŒå­¦çš„ä»£ç ä¸­å¯èƒ½ä¼šè¿™ä¹ˆå†™(å¦‚ä¸‹`demo`æ˜¯æ¨¡æ‹Ÿçš„æƒ…å†µï¼Œå®é™…è¦æ¯”è¿™å¤æ‚çš„å¤š)ã€‚

````js
class Index extends React.Component<any , any>{
    state = {
          loading:false /* ç”¨æ¥æ¨¡æ‹Ÿloadingæ•ˆæœ */,
          list:[],
    }
    componentDidMount(){
        /* æ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥è¯·æ±‚æ•°æ®åœºæ™¯ */
        this.setState({ loading : true }) /* å¼€å¯loadingæ•ˆæœ */
        Promise.resolve().then(()=>{
            const list = [ { id:1 , name: 'xixi' } ,{ id:2 , name: 'haha' },{ id:3 , name: 'heihei' } ]
            this.setState({ loading : false },()=>{
                this.setState({
                    list:list.map(item=>({
                        ...item,
                        name:item.name.toLocaleUpperCase()
                    }))
                })
            })
        })
    }
    render(){
    const { list } = this.state
    return <div>{
            list.map(item=><div key={item.id}  >{ item.name }</div>)
        }</div>
    }
}
````
åˆ†åˆ«ç”¨ä¸¤æ¬¡`this.state`ç¬¬ä¸€æ¬¡è§£é™¤`loading`çŠ¶æ€ï¼Œç¬¬äºŒæ¬¡æ ¼å¼åŒ–æ•°æ®åˆ—è¡¨ã€‚è¿™å¦ä¸¤æ¬¡æ›´æ–°å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œå¯ä»¥ç”¨ä¸€æ¬¡`setState`æ›´æ–°å®Œç¾è§£å†³ã€‚ä¸è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œå¯¹äºåƒ`demo`è¿™æ ·çš„ç®€å•ç»“æ„è¿˜å¥½ï¼Œå¯¹äºå¤æ‚çš„ç»“æ„ï¼Œä¸€æ¬¡æ›´æ–°å¯èƒ½éƒ½æ˜¯å®è´µçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å­¦ä¼šå»åˆå¹¶stateã€‚å°†ä¸Šè¿°demoè¿™æ ·ä¿®æ”¹ã€‚

````js
this.setState({
    loading : false,
    list:list.map(item=>({
        ...item,
        name:item.name.toLocaleUpperCase()
    }))
})
````

#### å‡½æ•°ç»„ä»¶(æ— çŠ¶æ€ç»„ä»¶)

å¯¹äºæ— çŠ¶æ€ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª`useState`ä¿å­˜å¤šä¸ªçŠ¶æ€ï¼Œæ²¡æœ‰å¿…è¦æ¯ä¸€ä¸ªçŠ¶æ€éƒ½ç”¨ä¸€ä¸ª`useState`ã€‚

å¯¹äºè¿™æ ·çš„æƒ…å†µã€‚
````js
const [ a ,setA ] = useState(1)
const [ b ,setB ] = useState(2)
````

æˆ‘ä»¬å®Œå…¨å¯ä»¥ä¸€ä¸ª`state`æå®šã€‚

````js
const [ numberState , setNumberState ] = useState({ a:1 , b :2})
````

ä½†æ˜¯è¦æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬çš„stateå·²ç»æˆä¸º `useEffect` , `useCallback` , `useMemo`ä¾èµ–é¡¹ï¼Œè¯·æ…ç”¨å¦‚ä¸Šæ–¹æ³•ã€‚

### â‘¢ useMemo React.memoéš”ç¦»å•å…ƒ

`react`æ­£å¸¸çš„æ›´æ–°æµï¼Œå°±åƒåˆ©å‰‘ä¸€ä¸‹ï¼Œä»çˆ¶ç»„ä»¶é¡¹å­ç»„ä»¶ç©¿é€ï¼Œä¸ºäº†é¿å…è¿™äº›é‡å¤çš„æ›´æ–°æ¸²æŸ“ï¼Œ`shouldComponentUpdate` , `React.memo`ç­‰`api`ä¹Ÿåº”è¿è€Œç”Ÿã€‚ä½†æ˜¯æœ‰çš„æƒ…å†µä¸‹ï¼Œå¤šä½™çš„æ›´æ–°åœ¨æ‰€éš¾å…ï¼Œæ¯”å¦‚å¦‚ä¸‹è¿™ç§æƒ…å†µã€‚è¿™ç§æ›´æ–°ä¼šç”±çˆ¶ç»„ä»¶ -> å­ç»„ä»¶ ä¼ é€’ä¸‹å»ã€‚

````js
function ChildrenComponent(){
    console.log(2222)
    return <div>hello,world</div>
}
function Index (){
    const [ list  ] = useState([ { id:1 , name: 'xixi' } ,{ id:2 , name: 'haha' },{ id:3 , name: 'heihei' } ])
    const [ number , setNumber ] = useState(0)
    return <div>
       <span>{ number }</span>
       <button onClick={ ()=> setNumber(number + 1) } >ç‚¹å‡»</button>
           <ul>
               {
                list.map(item=>{
                    console.log(1111)
                    return <li key={ item.id }  >{ item.name }</li>
                })
               }
           </ul>
           <ChildrenComponent />
    </div>
}
````
**æ•ˆæœ**


é’ˆå¯¹è¿™ä¸€ç°è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨`useMemo`è¿›è¡Œéš”ç¦»ï¼Œå½¢æˆç‹¬ç«‹çš„æ¸²æŸ“å•å…ƒï¼Œæ¯æ¬¡æ›´æ–°ä¸Šä¸€ä¸ªçŠ¶æ€ä¼šè¢«ç¼“å­˜ï¼Œå¾ªç¯ä¸ä¼šå†æ‰§è¡Œï¼Œå­ç»„ä»¶ä¹Ÿä¸ä¼šå†æ¬¡è¢«æ¸²æŸ“,æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšã€‚

````js
function Index (){
    const [ list  ] = useState([ { id:1 , name: 'xixi' } ,{ id:2 , name: 'haha' },{ id:3 , name: 'heihei' } ])
    const [ number , setNumber ] = useState(0)
    return <div>
       <span>{ number }</span>
       <button onClick={ ()=> setNumber(number + 1) } >ç‚¹å‡»</button>
           <ul>
               {
                useMemo(()=>(list.map(item=>{
                    console.log(1111)
                    return <li key={ item.id }  >{ item.name }</li>
                })),[ list ])
               }
           </ul>
        { useMemo(()=> <ChildrenComponent />,[]) }
    </div>
}
````

**æœ‰çŠ¶æ€ç»„ä»¶**

åœ¨`class`å£°æ˜çš„ç»„ä»¶ä¸­ï¼Œæ²¡æœ‰åƒ `useMemo` çš„`API` ï¼Œä½†æ˜¯ä¹Ÿå¹¶ä¸ç­‰äºæŸæ‰‹æ— ç­–ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `react.memo` æ¥é˜»æ‹¦æ¥è‡ªç»„ä»¶æœ¬èº«çš„æ›´æ–°ã€‚æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç»„ä»¶ï¼Œæ¥æ§åˆ¶`react` ç»„ä»¶æ›´æ–°çš„æ–¹å‘ã€‚æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª `<NotUpdate>` ç»„ä»¶æ¥é˜»æ–­æ›´æ–°æµã€‚

````js
/* æ§åˆ¶æ›´æ–° ,ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥ä½œä¸ºç»„ä»¶æ›´æ–°çš„ä¾èµ– ï¼Œ è¿™é‡Œè®¾ç½®ä¸º ()=> true åªæ¸²æŸ“ä¸€æ¬¡ */
const NotUpdate = React.memo(({ children }:any)=> typeof children === 'function' ? children() : children ,()=>true)

class Index extends React.Component<any,any>{
    constructor(prop){
        super(prop)
        this.state = { 
            list: [ { id:1 , name: 'xixi' } ,{ id:2 , name: 'haha' },{ id:3 , name: 'heihei' } ],
            number:0,
         }
    }
    handerClick = ()=>{
        this.setState({ number:this.state.number + 1 })
    }
    render(){
       const { list }:any = this.state
       return <div>
           <button onClick={ this.handerClick } >ç‚¹å‡»</button>
           <NotUpdate>
              {()=>(<ul>
                    {
                    list.map(item=>{
                        console.log(1111)
                        return <li key={ item.id }  >{ item.name }</li>
                    })
                    }
                </ul>)}
           </NotUpdate>
           <NotUpdate>
                <ChildrenComponent />
           </NotUpdate>
          
       </div>
    }
}

````
````js
const NotUpdate = React.memo(({ children }:any)=> typeof children === 'function' ? children() : children ,()=>true)
````

æ²¡é”™ï¼Œç”¨çš„å°±æ˜¯ `React.memo`ï¼Œç”Ÿæˆäº†é˜»æ–­æ›´æ–°çš„éš”ç¦»å•å…ƒï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æ§åˆ¶æ›´æ–°ï¼Œå¯ä»¥å¯¹ ` React.memo` ç¬¬äºŒä¸ªå‚æ•°å…¥æ‰‹ï¼Œ `demo`é¡¹ç›®ä¸­å®Œå…¨é˜»æ–­çš„æ›´æ–°ã€‚

### â‘£ â€˜å–ç¼”â€™stateï¼Œå­¦ä¼šä½¿ç”¨ç¼“å­˜ã€‚

è¿™é‡Œçš„å–ç¼”`state`ï¼Œå¹¶å®Œå…¨ä¸ä½¿ç”¨`state`æ¥ç®¡ç†æ•°æ®ï¼Œè€Œæ˜¯å–„äºä½¿ç”¨`state`,çŸ¥é“ä»€ä¹ˆæ—¶å€™ä½¿ç”¨,æ€ä¹ˆä½¿ç”¨ã€‚`react` å¹¶ä¸åƒ `vue` é‚£æ ·å“åº”å¼æ•°æ®æµã€‚ åœ¨ `vue`ä¸­ æœ‰ä¸“é—¨çš„`dep`åšä¾èµ–æ”¶é›†ï¼Œå¯ä»¥è‡ªåŠ¨æ”¶é›†å­—ç¬¦ä¸²æ¨¡ç‰ˆçš„ä¾èµ–é¡¹ï¼Œåªè¦æ²¡æœ‰å¼•ç”¨çš„`data`æ•°æ®ï¼Œ é€šè¿‡ `this.aaa = bbb` ,åœ¨`vue`ä¸­æ˜¯ä¸ä¼šæ›´æ–°æ¸²æŸ“çš„ã€‚å› ä¸º `aaa` çš„`dep`æ²¡æœ‰æ”¶é›†æ¸²æŸ“`watcher`ä¾èµ–é¡¹ã€‚åœ¨`react`ä¸­ï¼Œæˆ‘ä»¬è§¦å‘`this.setState` æˆ–è€… `useState`ï¼Œåªä¼šå…³å¿ƒä¸¤æ¬¡`state`å€¼æ˜¯å¦ç›¸åŒï¼Œæ¥è§¦å‘æ¸²æŸ“ï¼Œæ ¹æœ¬ä¸ä¼šåœ¨ä¹`jsx`è¯­æ³•ä¸­æ˜¯å¦çœŸæ­£çš„å¼•å…¥äº†æ­£ç¡®çš„å€¼ã€‚

#### æ²¡æœ‰æ›´æ–°ä½œç”¨çš„state

**æœ‰çŠ¶æ€ç»„ä»¶ä¸­**
````js
class Demo extends React.Component{
    state={ text:111 }
    componentDidMount(){
        const { a } = this.props
         /* æˆ‘ä»¬åªæ˜¯å¸Œæœ›åœ¨åˆå§‹åŒ–,ç”¨textè®°å½• propsä¸­ a çš„å€¼ */
        this.setState({
            text:a
        })    
    }
    render(){
        /* æ²¡æœ‰å¼•å…¥text */
       return <div>{'hello,world'}</div>
    }
}
````
å¦‚ä¸Šä¾‹å­ä¸­,`render`å‡½æ•°ä¸­å¹¶æ²¡æœ‰å¼•å…¥`text` ,æˆ‘ä»¬åªæ˜¯å¸Œæœ›åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œç”¨ `text` è®°å½• `props` ä¸­ `a` çš„å€¼ã€‚æˆ‘ä»¬å´ç”¨ `setState` è§¦å‘äº†ä¸€æ¬¡æ— ç”¨çš„æ›´æ–°ã€‚æ— çŠ¶æ€ç»„ä»¶ä¸­æƒ…å†µä¹Ÿä¸€æ ·å­˜åœ¨ï¼Œå…·ä½“å¦‚ä¸‹ã€‚
 
**æ— çŠ¶æ€ç»„ä»¶ä¸­**

````js
function Demo ({ a }){
    const [text , setText] = useState(111)
    useEffect(()=>{
        setText(a)
    },[])
    return <div>
         {'hello,world'}
    </div>
}
````

#### æ”¹ä¸ºç¼“å­˜


**æœ‰çŠ¶æ€ç»„ä»¶ä¸­**

åœ¨`class`å£°æ˜ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠæ•°æ®ç»‘å®šç»™`this`ä¸Šï¼Œæ¥ä½œä¸ºæ•°æ®ç¼“å­˜ã€‚

````js
class Demo extends React.Component{
    text = 111
    componentDidMount(){
        const { a } = this.props
        /* æ•°æ®ç›´æ¥ä¿å­˜åœ¨textä¸Š */
        this.text = a
    }
    render(){
        /* æ²¡æœ‰å¼•å…¥text */
       return <div>{'hello,world'}</div>
    }
}
````

**æ— çŠ¶æ€ç»„ä»¶ä¸­**

åœ¨æ— çŠ¶æ€ç»„ä»¶ä¸­, æˆ‘ä»¬ä¸èƒ½å¾€é—®`this`,ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨`useRef`æ¥è§£å†³é—®é¢˜ã€‚ 

````js
function Demo ({ a }){
    const text = useRef(111)
    useEffect(()=>{
        text.current = a
    },[])
    return <div>
        {'hello,world'}
    </div>
}
````


### â‘¤ useCallbackå›è°ƒ

`useCallback` çš„çœŸæ­£ç›®çš„è¿˜æ˜¯åœ¨äºç¼“å­˜äº†æ¯æ¬¡æ¸²æŸ“æ—¶ `inline callback` çš„å®ä¾‹ï¼Œè¿™æ ·æ–¹ä¾¿é…åˆä¸Šå­ç»„ä»¶çš„ `shouldComponentUpdate` æˆ–è€… `React.memo` èµ·åˆ°å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“çš„ä½œç”¨ã€‚å¯¹å­ç»„ä»¶çš„æ¸²æŸ“é™å®šæ¥æºä¸ï¼Œå¯¹å­ç»„ä»¶`props`æ¯”è¾ƒï¼Œä½†æ˜¯å¦‚æœå¯¹çˆ¶ç»„ä»¶çš„`callback`åšæ¯”è¾ƒï¼Œæ— çŠ¶æ€ç»„ä»¶æ¯æ¬¡æ¸²æŸ“æ‰§è¡Œï¼Œéƒ½ä¼šå½¢æˆæ–°çš„`callback` ,æ˜¯æ— æ³•æ¯”è¾ƒï¼Œæ‰€ä»¥éœ€è¦å¯¹`callback`åšä¸€ä¸ª `memoize` è®°å¿†åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸º`useCallback`å°±æ˜¯ `callback`åŠ äº†ä¸€ä¸ª`memoize`ã€‚æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ğŸ‘‡ğŸ‘‡ğŸ‘‡ã€‚

````js
function demo (){
    const [ number , setNumber ] = useState(0)
    return <div>  
        <DemoComponent  handerChange={ ()=>{ setNumber(number+1)  } } />
    </div>
}
````
æˆ–ç€

````js
function demo (){
    const [ number , setNumber ] = useState(0)
    const handerChange = ()=>{
        setNumber(number+1) 
    }
    return <div>  
        <DemoComponent  handerChange={ handerChange } />
    </div>
}
````
æ— è®ºæ˜¯ä¸Šè¿°é‚£ç§æ–¹å¼ï¼Œ`pureComponent` å’Œ `react.memo` é€šè¿‡æµ…æ¯”è¾ƒæ–¹å¼ï¼Œåªèƒ½åˆ¤æ–­æ¯æ¬¡æ›´æ–°éƒ½æ˜¯æ–°çš„`callback`ï¼Œç„¶åè§¦å‘æ¸²æŸ“æ›´æ–°ã€‚`useCallback`ç»™åŠ äº†ä¸€ä¸ªè®°å¿†åŠŸèƒ½ï¼Œå‘Šè¯‰æˆ‘ä»¬å­ç»„ä»¶ï¼Œä¸¤æ¬¡æ˜¯ç›¸åŒçš„ `callback`æ— éœ€é‡æ–°æ›´æ–°é¡µé¢ã€‚è‡³äºä»€ä¹ˆæ—¶å€™`callback`æ›´æ”¹ï¼Œå°±è¦å–å†³äº `useCallback` ç¬¬äºŒä¸ªå‚æ•°ã€‚å¥½çš„ï¼Œå°†ä¸Šè¿°`demo`æˆ‘ä»¬ç”¨ `useCallback` é‡å†™ã€‚

````js
function demo (){
    const [ number , setNumber ] = useState(0)
    const handerChange = useCallback( ()=>{
        setNumber(number+1) 
    },[])
    return <div>  
        <DemoComponent  handerChange={ handerChange } />
    </div>
}
````
è¿™æ · `pureComponent` å’Œ `react.memo`  å¯ä»¥ç›´æ¥åˆ¤æ–­æ˜¯`callback`æ²¡æœ‰æ”¹å˜ï¼Œé˜²æ­¢äº†ä¸å¿…è¦æ¸²æŸ“ã€‚



## ä¸ƒ ä¸­è§„ä¸­çŸ©çš„ä½¿ç”¨çŠ¶æ€ç®¡ç†

æ— è®ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯`redux`è¿˜æ˜¯è¯´ `redux` è¡ç”Ÿå‡ºæ¥çš„ `dva` ,`redux-saga`ç­‰,æˆ–è€…æ˜¯`mobx`ï¼Œéƒ½è¦éµå¾ªä¸€å®š'ä½¿ç”¨è§„åˆ™'ï¼Œé¦–å…ˆè®©æˆ‘æƒ³åˆ°çš„æ˜¯ï¼Œ**ä»€ä¹ˆæ—¶å€™ç”¨çŠ¶æ€ç®¡ç†**ï¼Œ**æ€ä¹ˆåˆç†çš„åº”ç”¨çŠ¶æ€ç®¡ç†**ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚

### ä»€ä¹ˆæ—¶å€™ä½¿ç”¨çŠ¶æ€ç®¡ç†

è¦é—®æˆ‘ä»€ä¹ˆæ—¶å€™é€‚åˆä½¿ç”¨çŠ¶æ€çŠ¶æ€ç®¡ç†ã€‚æˆ‘ä¸€å®šä¼šè¿™ä¹ˆåˆ†æï¼Œé¦–å…ˆçŠ¶æ€ç®¡ç†æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼ŒçŠ¶æ€ç®¡ç†èƒ½å¤Ÿè§£å†³çš„é—®é¢˜ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ å°±æ˜¯è§£å†³è·¨å±‚çº§ç»„ä»¶é€šä¿¡é—®é¢˜ ã€‚äºŒ å°±æ˜¯å¯¹ä¸€äº›å…¨å±€å…¬å…±çŠ¶æ€çš„ç¼“å­˜ã€‚

æˆ‘ä»¬é‚£reduxç³»åˆ—çš„çŠ¶æ€ç®¡ç†ä¸ºä¾‹å­ã€‚

æˆ‘è§è¿‡åˆåŒå­¦è¿™ä¹ˆå†™çš„

#### æ»¥ç”¨çŠ¶æ€ç®¡ç† 

````tsx
/* å’Œ storeä¸‹é¢textæ¨¡å—çš„liståˆ—è¡¨ï¼Œå»ºç«‹èµ·ä¾èµ–å…³ç³»ï¼Œlistæ›´æ–°ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ */
@connect((store)=>({ list:store.text.list }))
class Text extends React.Component{
    constructor(prop){
        super(prop)
    }
    componentDidMount(){
        /* åˆå§‹åŒ–è¯·æ±‚æ•°æ® */
        this.getList()
    }
    getList=()=>{
        const { dispatch } = this.props
        /* è·å–æ•°æ® */
        dispatch({ type:'text/getDataList' })
    }
    render(){
        const { list } = this.props
        return <div>
            {
                list.map(item=><div key={ item.id } >
                    { /*  åšä¸€äº›æ¸²æŸ“é¡µé¢çš„æ“ä½œ....  */ }
                </div>)
            }
            <button onClick={ ()=>this.getList() } >é‡æ–°è·å–åˆ—è¡¨</button>
        </div>
    }
}
````
è¿™æ ·é¡µé¢è¯·æ±‚æ•°æ®ï¼Œåˆ°æ•°æ®æ›´æ–°ï¼Œå…¨éƒ¨åœ¨å½“å‰ç»„ä»¶å‘ç”Ÿï¼Œè¿™ä¸ªå†™æ³•æˆ‘ä¸æ¨èï¼Œæ­¤æ—¶çš„æ•°æ®èµ°äº†ä¸€éçŠ¶æ€ç®¡ç†,æœ€ç»ˆè¿˜æ˜¯å›åˆ°äº†ç»„ä»¶æœ¬èº«ï¼Œæ˜¾å¾—å¾ˆé¸¡è‚‹ï¼Œå¹¶æ²¡æœ‰å‘æŒ¥ä»€ä¹ˆä½œç”¨ã€‚åœ¨æ€§èƒ½ä¼˜åŒ–ä¸Šåˆ°ä¸å¦‚ç›´æ¥åœ¨ç»„ä»¶å†…éƒ¨è¯·æ±‚æ•°æ®ã€‚

#### ä¸ä¼šåˆç†ä½¿ç”¨çŠ¶æ€ç®¡ç†
è¿˜æœ‰çš„åŒå­¦å¯èƒ½è¿™ä¹ˆå†™ã€‚

````js
class Text extends React.Component{
    constructor(prop){
        super(prop)
        this.state={
            list:[],
        }
    }
    async componentDidMount(){
        const { data , code } = await getList()
        if(code === 200){
            /*  è·å–çš„æ•°æ®æœ‰å¯èƒ½æ˜¯ä¸å¸¸å˜çš„ï¼Œå¤šä¸ªé¡µé¢éœ€è¦çš„æ•°æ®  */
            this.setState({
                list:data
            })
        }
    }
    render(){
        const { list } = this.state
        return <div>
            { /*  ä¸‹æ‹‰æ¡† */ }
            <select>
               {
                  list.map(item=><option key={ item.id } >{ item.name }</option>) 
               }
            </select>
        </div>
    }
}
````
å¯¹äºä¸å˜çš„æ•°æ®ï¼Œå¤šä¸ªé¡µé¢æˆ–ç»„ä»¶éœ€è¦çš„æ•°æ®ï¼Œä¸ºäº†é¿å…é‡å¤è¯·æ±‚,æˆ‘ä»¬å¯ä»¥å°†æ•°æ®æ”¾åœ¨çŠ¶æ€ç®¡ç†é‡Œé¢ã€‚

### å¦‚ä½•ä½¿ç”¨çŠ¶æ€ç®¡ç†
#### åˆ†æç»“æ„
æˆ‘ä»¬è¦å­¦ä¼šåˆ†æé¡µé¢ï¼Œé‚£äº›æ•°æ®æ˜¯ä¸å˜çš„ï¼Œé‚£äº›æ˜¯éšæ—¶å˜åŠ¨çš„ï¼Œç”¨ä»¥ä¸‹`demo`é¡µé¢ä¸ºä¾‹å­ï¼š



## å…« æµ·é‡æ•°æ®ä¼˜åŒ–-æ—¶é—´åˆ†ç‰‡ï¼Œè™šæ‹Ÿåˆ—è¡¨

### æ—¶é—´åˆ†ç‰‡

æ—¶é—´åˆ†ç‰‡çš„æ¦‚å¿µï¼Œå°±æ˜¯ä¸€æ¬¡æ€§æ¸²æŸ“å¤§é‡æ•°æ®ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ä¼šå‡ºç°å¡é¡¿ç­‰ç°è±¡ã€‚æˆ‘ä»¬å¿…é¡»è¦æ˜ç™½çš„ä¸€ä¸ªé“ç†ï¼Œ**jsæ‰§è¡Œæ°¸è¿œè¦æ¯”domæ¸²æŸ“å¿«çš„å¤šã€‚** ï¼Œæ‰€ä»¥å¯¹äºå¤§é‡çš„æ•°æ®ï¼Œä¸€æ¬¡æ€§æ¸²æŸ“ï¼Œå®¹æ˜“é€ æˆå¡é¡¿ï¼Œå¡æ­»çš„æƒ…å†µã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ä¾‹å­

````js
class Index extends React.Component<any,any>{
    state={
       list: []
    }
    handerClick=()=>{
       let starTime = new Date().getTime()
       this.setState({
           list: new Array(40000).fill(0)
       },()=>{
          const end =  new Date().getTime()
          console.log( (end - starTime ) / 1000 + 'ç§’')
       })
    }
    render(){
        const { list } = this.state
        console.log(list)
        return <div>
            <button onClick={ this.handerClick } >ç‚¹å‡»</button>
            {
                list.map((item,index)=><li className="list"  key={index} >
                    { item  + '' + index } Item
                </li>)
            }
        </div>
    }
}
````

æˆ‘ä»¬æ¨¡æ‹Ÿä¸€æ¬¡æ€§æ¸²æŸ“ 40000 ä¸ªåˆ—è¡¨ï¼Œçœ‹ä¸€ä¸‹éœ€è¦å¤šé•¿æ—¶é—´ã€‚


æˆ‘ä»¬çœ‹åˆ° 40000 ä¸ª ç®€å•åˆ—è¡¨æ¸²æŸ“äº†ï¼Œå°†è¿‘5ç§’çš„æ—¶é—´ã€‚ä¸ºäº†è§£å†³ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®çš„é—®é¢˜ã€‚æˆ‘ä»¬å¼•å‡ºäº†æ—¶é—´åˆ†ç‰‡çš„æ¦‚å¿µï¼Œå°±æ˜¯ç”¨`setTimeout`æŠŠä»»åŠ¡åˆ†å‰²ï¼Œåˆ†æˆè‹¥å¹²æ¬¡æ¥æ¸²æŸ“ã€‚ä¸€å…±40000ä¸ªæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥æ¯æ¬¡æ¸²æŸ“100ä¸ªï¼Œ åˆ†æ¬¡400æ¸²æŸ“ã€‚

````js
class Index extends React.Component<any,any>{
    state={
       list: []
    }
    handerClick=()=>{
       this.sliceTime(new Array(40000).fill(0), 0)
    }
    sliceTime=(list,times)=>{
        if(times === 400) return 
        setTimeout(() => {
            const newList = list.slice( times , (times + 1) * 100 ) /* æ¯æ¬¡æˆªå– 100 ä¸ª */
            this.setState({
                list: this.state.list.concat(newList)
            })
            this.sliceTime( list ,times + 1 )
        }, 0)
    }
    render(){
        const { list } = this.state
        return <div>
            <button onClick={ this.handerClick } >ç‚¹å‡»</button>
            {
                list.map((item,index)=><li className="list"  key={index} >
                    { item  + '' + index } Item
                </li>)
            }
        </div>
    }
}
````

**æ•ˆæœ**


`setTimeout` å¯ä»¥ç”¨ `window.requestAnimationFrame()` ä»£æ›¿ï¼Œä¼šæœ‰æ›´å¥½çš„æ¸²æŸ“æ•ˆæœã€‚
æˆ‘ä»¬`demo`ä½¿ç”¨åˆ—è¡¨åšçš„ï¼Œå®é™…å¯¹äºåˆ—è¡¨æ¥è¯´ï¼Œæœ€ä½³æ–¹æ¡ˆæ˜¯è™šæ‹Ÿåˆ—è¡¨ï¼Œè€Œæ—¶é—´åˆ†ç‰‡ï¼Œæ›´é€‚åˆçƒ­åŠ›å›¾ï¼Œåœ°å›¾ç‚¹ä½æ¯”è¾ƒå¤šçš„æƒ…å†µã€‚

### è™šæ‹Ÿåˆ—è¡¨

ç¬”è€…åœ¨æœ€è¿‘åœ¨åšå°ç¨‹åºå•†åŸé¡¹ç›®ï¼Œæœ‰é•¿åˆ—è¡¨çš„æƒ…å†µï¼Œ å¯æ˜¯è‚¯å®šè¯´  **è™šæ‹Ÿåˆ—è¡¨** æ˜¯è§£å†³é•¿åˆ—è¡¨æ¸²æŸ“çš„æœ€ä½³æ–¹æ¡ˆã€‚æ— è®ºæ˜¯å°ç¨‹åºï¼Œæˆ–è€…æ˜¯`h5` ï¼Œéšç€ `dom`å…ƒç´ è¶Šæ¥è¶Šå¤šï¼Œé¡µé¢ä¼šè¶Šæ¥è¶Šå¡é¡¿,è¿™ç§æƒ…å†µåœ¨å°ç¨‹åºæ›´åŠ æ˜æ˜¾ ã€‚ç¨åï¼Œç¬”è€…è®²ä¸“é—¨å†™ä¸€ç¯‡å°ç¨‹åºé•¿åˆ—è¡¨æ¸²æŸ“ç¼“å­˜æ–¹æ¡ˆçš„æ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å…³æ³¨ä¸€ä¸‹ç¬”è€…ã€‚

è™šæ‹Ÿåˆ—è¡¨æ˜¯æŒ‰éœ€æ˜¾ç¤ºçš„ä¸€ç§æŠ€æœ¯ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·çš„æ»šåŠ¨ï¼Œä¸å¿…æ¸²æŸ“æ‰€æœ‰åˆ—è¡¨é¡¹ï¼Œè€Œåªæ˜¯æ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„ä¸€éƒ¨åˆ†åˆ—è¡¨å…ƒç´ çš„æŠ€æœ¯ã€‚æ­£å¸¸çš„è™šæ‹Ÿåˆ—è¡¨åˆ†ä¸º æ¸²æŸ“åŒºï¼Œç¼“å†²åŒº ï¼Œè™šæ‹Ÿåˆ—è¡¨åŒºã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚




ä¸ºäº†é˜²æ­¢å¤§é‡`dom`å­˜åœ¨å½±å“æ€§èƒ½ï¼Œæˆ‘ä»¬åªå¯¹ï¼Œæ¸²æŸ“åŒºå’Œç¼“å†²åŒºçš„æ•°æ®åšæ¸²æŸ“ï¼Œï¼Œè™šæ‹Ÿåˆ—è¡¨åŒº æ²¡æœ‰çœŸå®çš„domå­˜åœ¨ã€‚ ç¼“å†²åŒºçš„ä½œç”¨å°±æ˜¯é˜²æ­¢å¿«é€Ÿä¸‹æ»‘æˆ–è€…ä¸Šæ»‘è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ç©ºç™½çš„ç°è±¡ã€‚

#### react-tiny-virtual-list
react-tiny-virtual-listâ€‚æ˜¯ä¸€ä¸ªè¾ƒä¸ºè½»é‡çš„å®ç°è™šæ‹Ÿåˆ—è¡¨çš„ç»„ä»¶ã€‚è¿™æ˜¯å®˜æ–¹æ–‡æ¡£ã€‚

````js
import React from 'react';
import {render} from 'react-dom';
import VirtualList from 'react-tiny-virtual-list';
 
const data = ['A', 'B', 'C', 'D', 'E', 'F', ...];
 
render(
  <VirtualList
    width='100%'
    height={600}
    itemCount={data.length}
    itemSize={50} // Also supports variable heights (array or function getter)
    renderItem={({index, style}) =>
      <div key={index} style={style}> // The style property contains the item's absolute position
        Letter: {data[index]}, Row: #{index}
      </div>
    }
  />,
  document.getElementById('root')
);
````
#### æ‰‹å†™ä¸€ä¸ªreactè™šæ‹Ÿåˆ—è¡¨

````js
let num  = 0
class Index extends React.Component<any, any>{
    state = {
        list: new Array(9999).fill(0).map(() =>{ 
            num++
            return num
        }),
        scorllBoxHeight: 500, /* å®¹å™¨é«˜åº¦(åˆå§‹åŒ–é«˜åº¦) */
        renderList: [],       /* æ¸²æŸ“åˆ—è¡¨ */
        itemHeight: 60,       /* æ¯ä¸€ä¸ªåˆ—è¡¨é«˜åº¦ */
        bufferCount: 8,       /* ç¼“å†²ä¸ªæ•° ä¸Šä¸‹å››ä¸ª */
        renderCount: 0,       /* æ¸²æŸ“æ•°é‡ */
        start: 0,             /* èµ·å§‹ç´¢å¼• */
        end: 0                /* ç»ˆæ­¢ç´¢å¼• */
    }
    listBox: any = null
    scrollBox : any = null
    scrollContent:any = null
    componentDidMount() {
        const { itemHeight, bufferCount } = this.state
        /* è®¡ç®—å®¹å™¨é«˜åº¦ */
        const scorllBoxHeight = this.listBox.offsetHeight
        const renderCount = Math.ceil(scorllBoxHeight / itemHeight) + bufferCount
        const end = renderCount + 1
        this.setState({
            scorllBoxHeight,
            end,
            renderCount,
        })
    }
    /* å¤„ç†æ»šåŠ¨æ•ˆæœ */
    handerScroll=()=>{
        const { scrollTop } :any =  this.scrollBox
        const { itemHeight , renderCount } = this.state
        const currentOffset = scrollTop - (scrollTop % itemHeight)
        /* translate3d å¼€å¯css cpu åŠ é€Ÿ */
        this.scrollContent.style.transform = `translate3d(0, ${currentOffset}px, 0)`
        const start = Math.floor(scrollTop / itemHeight)
        const end = Math.floor(scrollTop / itemHeight + renderCount + 1)
        this.setState({
            start,
            end,
       })
    }
     /* æ€§èƒ½ä¼˜åŒ–ï¼šåªæœ‰åœ¨åˆ—è¡¨start å’Œ end æ”¹å˜çš„æ—¶å€™åœ¨æ¸²æŸ“åˆ—è¡¨ */
    shouldComponentUpdate(_nextProps, _nextState){
        const { start , end } = _nextState
        return start !== this.state.start || end !==this.state.end 
    }
    /* å¤„ç†æ»šåŠ¨æ•ˆæœ */
    render() {
        console.log(1111)
        const { list, scorllBoxHeight, itemHeight ,start ,end } = this.state
        const renderList = list.slice(start,end)
        return <div className="list_box"
            ref={(node) => this.listBox = node}
        >   
            <div  
               style={{ height: scorllBoxHeight, overflow: 'scroll', position: 'relative' }}  
               ref={ (node)=> this.scrollBox = node }
               onScroll={ this.handerScroll }   
            >
                { /* å ä½ä½œç”¨ */}
                <div style={{ height: `${list.length * itemHeight}px`, position: 'absolute', left: 0, top: 0, right: 0 }} />
                { /* æ˜¾ç„¶åŒº */ }
                <div ref={(node) => this.scrollContent = node} style={{ position: 'relative', left: 0, top: 0, right: 0 }} >
                    {
                        renderList.map((item, index) => (
                            <div className="list" key={index} >
                                {item + '' } Item
                            </div>
                        ))
                    }
                </div>
            </div>

        </div>
    }
}
````
**æ•ˆæœ**


**å…·ä½“æ€è·¯**

â‘  åˆå§‹åŒ–è®¡ç®—å®¹å™¨çš„é«˜åº¦ã€‚æˆªå–åˆå§‹åŒ–åˆ—è¡¨é•¿åº¦ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦divå ä½,æ’‘èµ·æ»šåŠ¨æ¡ã€‚

â‘¡ é€šè¿‡ç›‘å¬æ»šåŠ¨å®¹å™¨çš„ `onScroll`äº‹ä»¶,æ ¹æ® `scrollTop` æ¥è®¡ç®—æ¸²æŸ“åŒºåŸŸå‘ä¸Šåç§»é‡, æˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬å‘ä¸‹æ»‘åŠ¨çš„æ—¶å€™ï¼Œä¸ºäº†æ¸²æŸ“åŒºåŸŸï¼Œèƒ½åœ¨å¯è§†åŒºåŸŸå†…ï¼Œå¯è§†åŒºåŸŸè¦å‘ä¸Šçš„æ»šåŠ¨; æˆ‘ä»¬å‘ä¸Šæ»‘åŠ¨çš„æ—¶å€™ï¼Œå¯è§†åŒºåŸŸè¦å‘ä¸‹çš„æ»šåŠ¨ã€‚

â‘¢ é€šè¿‡é‡æ–°è®¡ç®—çš„ `end` å’Œ `start` æ¥é‡æ–°æ¸²æŸ“åˆ—è¡¨ã€‚


**æ€§èƒ½ä¼˜åŒ–ç‚¹**

â‘  å¯¹äºç§»åŠ¨è§†å›¾åŒºåŸŸï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `transform` æ¥ä»£æ›¿æ”¹å˜ `top`å€¼ã€‚

â‘¡ è™šæ‹Ÿåˆ—è¡¨å®é™…æƒ…å†µï¼Œæ˜¯æœ‰ `start` æˆ–è€… `end` æ”¹å˜çš„æ—¶å€™ï¼Œåœ¨é‡æ–°æ¸²æŸ“åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¹‹å‰ `shouldComponentUpdate` æ¥è°ƒä¼˜ï¼Œé¿å…é‡å¤æ¸²æŸ“ã€‚