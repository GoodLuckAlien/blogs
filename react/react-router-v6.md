# ã€ŒReactè¿›é˜¶ã€react-router v6 åŸç†é€šå…³æŒ‡å—

## ä¸€ å‰è¨€

ä¸çŸ¥ä¸è§‰ `react-router` å·²ç»åˆ°äº† `v6` ç‰ˆæœ¬äº†ï¼Œå¯èƒ½å¾ˆå¤šåŒå­¦å‘ç°ï¼Œ`v6`ç›¸æ¯”ä¹‹å‰çš„ `v5` æœ‰ç€ç¿»å¤©è¦†åœ°çš„å˜åŒ–ï¼Œå› ä¸ºæœ€è¿‘æ¥è§¦åˆ°äº† React çš„æ–°é¡¹ç›®ï¼Œç”¨åˆ°äº† `v6` ç‰ˆæœ¬çš„ `react-router`ï¼Œäº²èº«ä½“éªŒå‘ç°è¿™è¿˜æ˜¯æˆ‘è®¤è¯†çš„ `router` å— ï¼Ÿ ä» api åˆ°åŸç†éƒ½æœ‰è¾ƒå¤§çš„æ”¹åŠ¨ï¼Œæ‰€ä»¥ä»Šå¤©å°±å’Œå¤§å®¶ä¸€èµ·çœ‹ä¸€ä¸‹æ–°ç‰ˆè·¯ç”±çš„å˜åŒ–ã€‚

å¯¹äºè¿™æ¬¡çš„æ”¹åŠ¨ï¼Œç¬”è€…çš„å»ºè®®æ˜¯ï¼š**å¦‚æœæ˜¯æ–°é¡¹ç›®ï¼Œå¯ä»¥å°è¯•æ–°ç‰ˆæœ¬çš„ `Rouer`ï¼Œå¯¹äºè€é¡¹ç›®ï¼Œå»ºè®®è¿˜æ˜¯ä¸è¦å°è¯•å‡çº§ v6 ï¼Œå‡çº§çš„ä»£ä»·æ˜¯ä¼šé€ æˆå¤§é‡çš„åŠŸèƒ½æ”¹åŠ¨ï¼Œè€Œä¸”å¦‚æœç”¨åˆ°äº†ä¾èµ–äº `router` çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå¯èƒ½ä¼šè®©è¿™äº›åº“å¤±æ•ˆã€‚** æ‰€ä»¥ä¸€äº›ä¾èµ–äº react-router çš„ç¬¬ä¸‰æ–¹åº“ï¼Œä¹Ÿéœ€è¦å‡çº§å»è¿åˆ `v6` ç‰ˆæœ¬äº†ï¼Œæ¯”å¦‚ç¬”è€…ä¹‹å‰çš„ç¼“å­˜é¡µé¢åŠŸèƒ½çš„ `react-keepalive-router`ï¼Œä¹Ÿä¼šæœ‰å¤§ç‰ˆæœ¬çš„æ›´æ–°ã€‚

é€šè¿‡æœ¬ç« èŠ‚çš„å­¦ä¹ ï¼Œä½ å°†å­¦ä¹ åˆ°ä»¥ä¸‹å†…å®¹ï¼š

* æ–°ç‰ˆæœ¬è·¯ç”±å’Œè€ç‰ˆæœ¬çš„å·®å¼‚ï¼Œä½¿ç”¨åŒºåˆ«ï¼ŒAPI åŒºåˆ«ã€‚
* æ–°ç‰ˆæœ¬è·¯ç”±ç»„ä»¶ Router ï¼ŒRoutes ï¼Œå’Œ Route çš„åŸç†ã€‚
* Outlet ç»„ä»¶åŸç†ã€‚
* useRoutes åŸç†ã€‚

è®©æˆ‘ä»¬å¼€å§‹ä»Šå¤©çš„ `router` v6 å­¦ä¹ ä¹‹æ—…å§ã€‚é€äººç«ç‘°ğŸŒ¹ï¼Œæ‰‹æœ‰ä½™é¦™ï¼Œå¸Œæœ›çœ‹å®Œè§‰çš„æœ‰æ”¶è·çš„åŒå­¦ï¼Œå¯ä»¥ç»™ç¬”è€…ç‚¹èµ â• å…³æ³¨ä¸€æ³¢ ï¼Œä»¥æ­¤é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œå‰ç«¯ç¡¬æ–‡ã€‚


## äºŒ åŸºæœ¬ä½¿ç”¨

é¦–å…ˆæˆ‘ä»¬ä»è·¯ç”±çš„ä½¿ç”¨æ–¹æ³•ä¸Šï¼Œæ¥çœ‹ä¸€ä¸‹ v6 çš„å˜åŒ–ï¼Œè¿˜æ˜¯ä¸¾ä¾‹ä¸€ä¸ªåœºæ™¯ã€‚æ¯”å¦‚æœ‰å¦‚ä¸‹çš„è·¯ç”±ç»“æ„ï¼š

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé¡µé¢åˆ†ä¸ºç®€å•çš„ 2 çº§è·¯ç”±ç»“æ„ï¼š

* ç¬¬ä¸€çº§é¡µé¢æœ‰ `home` é¡µé¢ï¼Œ `list` é¡µé¢ï¼Œå’Œ `children` é¡µé¢ã€‚
* ç¬¬äºŒçº§é¡µé¢æ˜¯ children é¡µé¢çš„å­è·¯ç”±ï¼ŒåŒ…æ‹¬ï¼š`child1` å’Œ `child2`ã€‚

æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ï¼Œæ–°è€ç‰ˆæœ¬è·¯ç”±åœ¨ä½¿ç”¨ä¸Šæœ‰ä»€ä¹ˆåŒºåˆ«ã€‚

### 1 è€ç‰ˆæœ¬è·¯ç”±

#### é…ç½®è€ç‰ˆæœ¬è·¯ç”±

**å…¥å£æ–‡ä»¶ -> ä¸€çº§è·¯ç”±**

````js
const index = () => {
  return <div className="page" >
    <div className="content" >
      <BrowserRouter>
         <Menus />
         <Switch>
            <Route component={Children} /* children ç»„ä»¶  */
                path="/children"
            ></Route>
            <Route component={Home}     /* home ç»„ä»¶  */
                path={'/home'}
            ></Route>
            <Route component={List}     /* list ç»„ä»¶ */
                path="/list"
            ></Route>
         </Switch>
      </BrowserRouter>
    </div>
  </div>
}
````
ä¸Šè¿°ä¸ºé…ç½®çš„ä¸€çº§è·¯ç”±çš„æƒ…å†µã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹å¤§ä½“çš„åŠŸèƒ½èŒè´£åˆ†é…ï¼š

* **`BrowserRouter`** ï¼šé€šè¿‡ history åº“ï¼Œä¼ é€’ `history` å¯¹è±¡ï¼Œ`location` å¯¹è±¡ã€‚
* **`Switch`**ï¼šåŒ¹é…å”¯ä¸€çš„è·¯ç”± `Route`ï¼Œå±•ç¤ºæ­£ç¡®çš„è·¯ç”±ç»„ä»¶ã€‚
* **`Route`**ï¼š è§†å›¾æ‰¿è½½å®¹å™¨ï¼Œæ§åˆ¶æ¸²æŸ“ `UI` ç»„ä»¶ã€‚

å¦‚ä¸Šæ˜¯ä¸€çº§è·¯ç”±çš„é…ç½®å’Œå¯¹åº”ç»„ä»¶çš„å±•ç¤ºï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹äºŒçº§è·¯ç”±çš„é…ç½®ï¼ŒäºŒçº§è·¯ç”±é…ç½®åœ¨ `Children` ä¸­ï¼š

````js
function Children (){
    return <div>
        è¿™é‡Œæ˜¯ children é¡µé¢
       <Menus />
       <Route component={Child1}
           path="/children/child1"
       />
       <Route component={Child2}
           path="/children/child2"
       />

    </div>
}
````
* å¯ä»¥çœ‹åˆ°åœ¨ `Children` ä¸­ï¼Œæœ‰ `Child1` å’Œ `Child2` ä¸¤ä¸ªç»„ä»¶ã€‚

çœ‹ä¸€ä¸‹æ•´ä½“æ•ˆæœï¼š


é‚£ä¹ˆæ•´ä½“è·¯ç”±å±‚çº§çš„ç»“æ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆé‡ç‚¹çœ‹å’Œ v6 çš„æ•´ä½“è®¾è®¡çš„åŒºåˆ« ï¼‰ï¼š



#### è·¯ç”±çŠ¶æ€å’Œé¡µé¢è·³è½¬

**v5å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–è·¯ç”±çŠ¶æ€**

* **`props` + `Route`**ï¼š Route æ‰¿è½½çš„ ui ç»„ä»¶å¯ä»¥é€šè¿‡ props æ¥è·å–è·¯ç”±çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦æŠŠè·¯ç”±çŠ¶æ€ä¼ é€’ç»™å­å­™ç»„ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ props é€å±‚ä¼ é€’çš„æ–¹å¼ã€‚  
* **`withRouter`** ï¼š withRouter æ˜¯ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ HOC ï¼Œå› ä¸ºé»˜è®¤åªæœ‰è¢« `Route` åŒ…è£¹çš„ç»„ä»¶æ‰èƒ½è·å–åˆ°è·¯ç”±çŠ¶æ€ï¼Œå¦‚æœå½“å‰éè·¯ç”±ç»„ä»¶è·å–çŠ¶æ€ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡ withRouter åŒ…è£¹æ¥è·å– `history` ï¼Œ`location` ç­‰ä¿¡æ¯ã€‚
* **`useHistory`** ï¼šå‡½æ•°ç»„ä»¶å¯ä»¥é€šè¿‡ `useHistory` è·å– `history` å¯¹è±¡ã€‚
* **`useLocation`** ï¼šå‡½æ•°ç»„ä»¶å¯ä»¥é€šè¿‡ `useLocation` è·å– `location` å¯¹è±¡ã€‚

**v5é€šè¿‡ä»¥ä¸‹æ–¹å¼å®ç°è·¯ç”±è·³è½¬**

ä¸Šé¢ä»‹ç»äº†è·¯ç”±çŠ¶æ€è·å–ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸€ä¸ªåœºæ™¯å°±æ˜¯åˆ‡æ¢è·¯ç”±ï¼Œé‚£ä¹ˆ v5 ä¸»è¦æ˜¯é€šè¿‡ä¸¤ç§æ–¹å¼æ”¹å˜è·¯ç”±ï¼š

* é€šè¿‡ `react-router-dom` å†…ç½®çš„ `Link`ï¼Œ `NavLink` ç»„ä»¶æ¥å®ç°è·¯ç”±è·³è½¬ã€‚
* é€šè¿‡ `history` å¯¹è±¡ä¸‹é¢çš„è·¯ç”±è·³è½¬æ–¹æ³•ï¼Œæ¯”å¦‚ push ç­‰ï¼Œæ¥å®ç°è·¯ç”±çš„è·³è½¬ã€‚


#### æ•´ä½“æ¶æ„è®¾è®¡

**è·¯ç”±çŠ¶æ€ä¼ é€’**

è‡³äºåœ¨ React åº”ç”¨ä¸­ï¼Œè·¯ç”±çŠ¶æ€æ˜¯é€šè¿‡ä»€ä¹ˆä¼ é€’çš„å‘¢ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨ React åº”ç”¨ä¸­ï¼Œ `Context` æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„çŠ¶æ€ä¼ é€’æ–¹æ¡ˆï¼Œé‚£ä¹ˆåœ¨ Router ä¸­ä¹Ÿæ˜¯é€šè¿‡ context æ¥ä¼ é€’çš„ï¼Œåœ¨ `react-router` `v5.1.0`åŠä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæ˜¯æŠŠ history ï¼Œlocation å¯¹è±¡ç­‰ä¿¡æ¯é€šè¿‡ä¸€ä¸ª `RouterContext` æ¥ä¼ é€’çš„ã€‚

åœ¨ v5.2.0 åˆ°æ–°ç‰ˆæœ¬ v5 React-Router ä¸­ï¼Œé™¤äº†ç”¨ `RouterContext` ä¿å­˜çŠ¶æ€ä¹‹å¤–ï¼Œhistory çŠ¶æ€ç”± `HistoryContext` å•ç‹¬ä¿å­˜ã€‚

**è·¯ç”±æ¨¡å—çš„æ•´ä½“è®¾è®¡**

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹ v5 çš„ react-router çš„æ•´ä½“è®¾è®¡ï¼š



### 2 v6 router å°é²œ


## ä¸‰ åŸç†åˆ†æ

### 1 æ–°ç‰ˆ Route è®¾è®¡

### 2 branch æ„Ÿå¿µ

### 3 Routes 

## å›› v5 å’Œ v6 åŒºåˆ« 

## äº” æ€»ç»“



### å‚è€ƒèµ„æ–™

* [Upgrading from v5](https://github.com/remix-run/react-router/blob/main/docs/upgrading/v5.md)


/*----------------------*/

Routes -> useRoutes 

useRoutes -> matchRoutes åŒ¹é…å”¯ä¸€è·¯ç”± -> _renderMatches

flattenRoutes

matchRoutes -> matchRouteBranch 

/*
branch = {
   path:'',
   routesMeta:[ routeItem ],
   score:24
}

routeItem = {
   caseSensitive,
   childrenIndex,
   relativePath,
   route: { children }
}

route = {
   caseSensitive,
   children,
   element, // ç»„ä»¶
   index,
   path
}
*/

